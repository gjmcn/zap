<!doctype html>
<html lang="en">

<head>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-163387970-1');
  </script>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="images/zap-black.png">
  <title>Zap docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="src/css/index.css">
  <link rel="stylesheet" href="src/css/docs-highlight.js.css">
</head>

<body>
  <div id='content-wrap'>
    <div id="sidebar">
      <a id="zap-title" href="#"><img src="images/zap-black.png">Zap</a>
      <a href="playground.html" target="_blank">Playground</a>
      <a href="https://github.com/gjmcn/zap" target="_blank">GitHub</a>
      <hr>
      <a id="side-link-overview" class="side-link" href="#overview">Overview</a><a id="side-link-use" class="side-link" href="#use">Use</a><a id="side-link-basic-syntax" class="side-link" href="#basic-syntax">Basic Syntax</a><a id="side-link-special-syntax" class="side-link" href="#special-syntax">Special Syntax</a><a id="side-link-operators" class="side-link" href="#operators">Operators</a><a id="side-link-literals" class="side-link" href="#literals">Literals</a><a id="side-link-calling-functions" class="side-link" href="#calling-functions">Calling Functions</a><a id="side-link-assignment" class="side-link" href="#assignment">Assignment</a><a id="side-link-get-property" class="side-link" href="#get-property">Get Property</a><a id="side-link-set-property" class="side-link" href="#set-property">Set Property</a><a id="side-link-writing-functions" class="side-link" href="#writing-functions">Writing Functions</a><a id="side-link-classes" class="side-link" href="#classes">Classes</a><a id="side-link-loops" class="side-link" href="#loops">Loops</a><a id="side-link-exceptions" class="side-link" href="#exceptions">Exceptions</a><a id="side-link-is" class="side-link" href="#is">Is</a><a id="side-link-elementwise" class="side-link" href="#elementwise">Elementwise</a><a id="side-link-conditional" class="side-link" href="#conditional">Conditional</a><a id="side-link-ranges" class="side-link" href="#ranges">Ranges</a><a id="side-link-backticks" class="side-link" href="#backticks">Backticks</a><a id="side-link-reduce" class="side-link" href="#reduce">Reduce</a><a id="side-link-filter" class="side-link" href="#filter">Filter</a><a id="side-link-group" class="side-link" href="#group">Group</a><a id="side-link-order" class="side-link" href="#order">Order</a><a id="side-link-bin" class="side-link" href="#bin">Bin</a><a id="side-link-joins" class="side-link" href="#joins">Joins</a><a id="side-link-random" class="side-link" href="#random">Random</a><a id="side-link-interpolate" class="side-link" href="#interpolate">Interpolate</a><a id="side-link-nested-data" class="side-link" href="#nested-data">Nested Data</a><a id="side-link-set-theory" class="side-link" href="#set-theory">Set Theory</a><a id="side-link-import-and-export" class="side-link" href="#import-and-export">Import and Export</a><a id="side-link-print-and-debug" class="side-link" href="#print-and-debug">Print and Debug</a><a id="side-link-dom" class="side-link" href="#dom">DOM</a>
      <br><br><br>
    </div>
    <div id="panel">
      <h2 id="overview">Overview</h2>
<hr>
<p>Zap is a compile-to-JavaScript language with a clean, concise syntax and powerful high-level operators. Zap can use JavaScript objects and libraries, and vice-versa.</p>
<p>Literals are particularly simple:</p>
<pre><code class="language-zap"><span class="hljs-keyword">#</span> u <span class="hljs-number">5</span> v <span class="hljs-number">6</span>    <span class="hljs-comment">// Object {u: 5, v: 6}</span>
<span class="hljs-keyword">##</span> u <span class="hljs-number">5</span> v <span class="hljs-number">6</span>   <span class="hljs-comment">// Map {&#x27;u&#x27; =&gt; 5, &#x27;v&#x27; =&gt; 6}</span>
<span class="hljs-keyword">@</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>        <span class="hljs-comment">// Array [5, 6]</span>
<span class="hljs-keyword">@@</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>       <span class="hljs-comment">// Set {5, 6}</span>
</code></pre>
<p>Everything in Zap is an expression — no blocks, statements or keywords. Except for a few special cases, code reads left to right and the 'current' operator is applied when the next operator or the end of the expression is reached:</p>
<pre><code class="language-zap"><span class="hljs-keyword">@</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>     <span class="hljs-comment">// [3, 4, 5]</span>
<span class="hljs-number">3</span> <span class="hljs-keyword">@</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>     <span class="hljs-comment">// [3, 4, 5]</span>
<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-keyword">@</span>     <span class="hljs-comment">// [3, 4, 5]</span>

<span class="hljs-number">3</span> <span class="hljs-keyword">+</span> <span class="hljs-number">4</span> <span class="hljs-keyword">@</span> <span class="hljs-number">5</span>   <span class="hljs-comment">// [7, 5]</span>
<span class="hljs-keyword">+</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-keyword">@</span> <span class="hljs-number">5</span>   <span class="hljs-comment">// [7, 5]</span>
<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-keyword">+</span> <span class="hljs-keyword">@</span> <span class="hljs-number">5</span>   <span class="hljs-comment">// [7, 5]</span>
</code></pre>
<p>Basic operators such as <code>+</code> can take more the two operands:</p>
<pre><code class="language-zap"><span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-keyword">+</span>   <span class="hljs-comment">// 12</span>
<span class="hljs-keyword">+</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>   <span class="hljs-comment">// 12</span>
</code></pre>
<p>Many operators have names rather than symbols:</p>
<pre><code class="language-zap"><span class="hljs-number">5</span> <span class="hljs-keyword">isNumber</span> <span class="hljs-keyword">print</span>   <span class="hljs-comment">// prints (and returns) true</span>
</code></pre>
<p>Indented blocks or parentheses can be used for precedence:</p>
<pre><code class="language-zap"><span class="hljs-number">3</span> <span class="hljs-keyword">*</span> (<span class="hljs-number">4</span> <span class="hljs-keyword">+</span> <span class="hljs-number">5</span>)   <span class="hljs-comment">// 27</span>
<span class="hljs-number">3</span> <span class="hljs-keyword">*</span> 
    <span class="hljs-number">4</span> <span class="hljs-keyword">+</span> <span class="hljs-number">5</span>     <span class="hljs-comment">// 27</span>

x <span class="hljs-keyword">=</span> <span class="hljs-keyword">@</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>
x <span class="hljs-keyword">each</span> v (<span class="hljs-keyword">print</span> v)   <span class="hljs-comment">// prints 3 4 5</span>
x <span class="hljs-keyword">each</span> v             
    <span class="hljs-keyword">print</span> v          <span class="hljs-comment">// prints 3 4 5</span>
</code></pre>
<p>Indented blocks can contain multiple expressions:</p>
<pre><code class="language-zap"><span class="hljs-comment">// prints 12 30 56</span>
<span class="hljs-keyword">@</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-keyword">each</span> value index
    z <span class="hljs-keyword">=</span> value <span class="hljs-keyword">+</span> index
    z <span class="hljs-keyword">^</span> <span class="hljs-number">2</span> <span class="hljs-keyword">+</span> z <span class="hljs-keyword">print</span>
</code></pre>
<p>An expression terminates at the end of a line unless the following line opens an indentated block or continues the line with <code>|</code>.</p>
<pre><code class="language-zap"><span class="hljs-comment">// array-of-objects</span>
dogs <span class="hljs-keyword">=</span> 
    <span class="hljs-keyword">@</span>
        <span class="hljs-keyword">#</span>
        | name <span class="hljs-string">&#x27;Bill&#x27;</span>
        | breed <span class="hljs-string">&#x27;boxer&#x27;</span>
        | food (<span class="hljs-keyword">@</span> <span class="hljs-string">&#x27;bananas&#x27;</span> <span class="hljs-string">&#x27;beans&#x27;</span> <span class="hljs-string">&#x27;biscuits&#x27;</span>)
    | 
        <span class="hljs-keyword">#</span>
        | name <span class="hljs-string">&#x27;Debra&#x27;</span>
        | breed <span class="hljs-string">&#x27;doberman&#x27;</span>
        | food (<span class="hljs-keyword">@</span> <span class="hljs-string">&#x27;dates&#x27;</span> <span class="hljs-string">&#x27;donuts&#x27;</span>)

<span class="hljs-comment">// on fewer lines</span>
dogs <span class="hljs-keyword">=</span> <span class="hljs-keyword">@</span>
| (<span class="hljs-keyword">#</span> name <span class="hljs-string">&#x27;Bill&#x27;</span>  breed <span class="hljs-string">&#x27;boxer&#x27;</span>    food (<span class="hljs-keyword">@</span> <span class="hljs-string">&#x27;bananas&#x27;</span> <span class="hljs-string">&#x27;beans&#x27;</span> <span class="hljs-string">&#x27;biscuits&#x27;</span>))
| (<span class="hljs-keyword">#</span> name <span class="hljs-string">&#x27;Debra&#x27;</span> breed <span class="hljs-string">&#x27;doberman&#x27;</span> food (<span class="hljs-keyword">@</span> <span class="hljs-string">&#x27;dates&#x27;</span> <span class="hljs-string">&#x27;donuts&#x27;</span>))
</code></pre>
<p><code>fun</code> creates a function; <code>\</code> calls a function. <code>\</code> has special behavior: the first right operand is always the function:</p>
<pre><code class="language-zap">double <span class="hljs-keyword">=</span> <span class="hljs-keyword">fun</span> x (<span class="hljs-number">2</span> <span class="hljs-keyword">*</span> x)   <span class="hljs-comment">// body in parentheses</span>

add <span class="hljs-keyword">=</span> <span class="hljs-keyword">fun</span> x y
    x <span class="hljs-keyword">+</span> y                <span class="hljs-comment">// body in indented block</span>

<span class="hljs-keyword">\</span>double <span class="hljs-number">5</span> <span class="hljs-keyword">\</span>add <span class="hljs-number">20</span>        <span class="hljs-comment">// 30</span>
<span class="hljs-number">5</span> <span class="hljs-keyword">\</span>double <span class="hljs-keyword">\</span>add <span class="hljs-number">20</span>        <span class="hljs-comment">// 30</span>
<span class="hljs-keyword">\</span>add (<span class="hljs-keyword">\</span>double <span class="hljs-number">5</span>) <span class="hljs-number">20</span>      <span class="hljs-comment">// 30</span>
</code></pre>
<p>Bracket functions can be used for 'one-liners'. Bracket functions have parameters <code>a</code>, <code>b</code> and <code>c</code>, and are comprised of a single expression:</p>
<pre><code class="language-zap">add <span class="hljs-keyword">=</span> [a <span class="hljs-keyword">+</span> b]   <span class="hljs-comment">// function</span>
</code></pre>
<p>The <code>~</code> operator calls a method:</p>
<pre><code class="language-zap"><span class="hljs-string">&#x27;abcd&#x27;</span> <span class="hljs-keyword">~</span>slice <span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-keyword">~</span>repeat <span class="hljs-number">2</span>   <span class="hljs-comment">// &#x27;bcbc&#x27;</span>
</code></pre>
<p>The range operators create generators:</p>
<pre><code class="language-zap"><span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-number">3</span>           <span class="hljs-comment">// generator (1 2 3)</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-number">7</span> <span class="hljs-number">2</span>         <span class="hljs-comment">// generator (1 3 5 7)</span>
<span class="hljs-number">1</span> <span class="hljs-number">7</span> <span class="hljs-keyword">linSpace</span> <span class="hljs-number">4</span>   <span class="hljs-comment">// generator (1 3 5 7)</span>
</code></pre>
<p>There are lots of operators for working with iterables (arrays, sets, generators etc.). For example:</p>
<pre><code class="language-zap">s <span class="hljs-keyword">=</span> <span class="hljs-keyword">@@</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span>              <span class="hljs-comment">// Set {5, 6, 7}</span>
s <span class="hljs-keyword">array</span>                   <span class="hljs-comment">// [5, 6, 7]</span>
s <span class="hljs-keyword">each</span> x (x <span class="hljs-keyword">+</span> <span class="hljs-number">10</span> <span class="hljs-keyword">print</span>)   <span class="hljs-comment">// prints 15 16 17</span>
s <span class="hljs-keyword">map</span> x (x <span class="hljs-keyword">+</span> <span class="hljs-number">10</span>)          <span class="hljs-comment">// [15, 16, 17]</span>
s <span class="hljs-keyword">max</span>                     <span class="hljs-comment">// 7</span>
s <span class="hljs-keyword">sum</span>                     <span class="hljs-comment">// 18</span>
s <span class="hljs-keyword">filter</span> [a <span class="hljs-keyword">&gt;</span> <span class="hljs-number">5</span>]          <span class="hljs-comment">// [6, 7] </span>
s <span class="hljs-keyword">group</span> [a <span class="hljs-keyword">&gt;</span> <span class="hljs-number">5</span>]           <span class="hljs-comment">// Map {false =&gt; [5], true =&gt; [6, 7]}</span>
</code></pre>
<p>Backticks tell an arithmetic, logical or comparison operator to iterate over an operand:</p>
<pre><code class="language-zap">x <span class="hljs-keyword">=</span> <span class="hljs-keyword">@</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span>     <span class="hljs-comment">// [5, 6, 7]</span>
x  <span class="hljs-keyword">`+</span>  <span class="hljs-number">10</span>       <span class="hljs-comment">// [15, 16, 17]       </span>
<span class="hljs-number">10</span>  <span class="hljs-keyword">+`</span> x        <span class="hljs-comment">// [15, 16, 17]</span>
x  <span class="hljs-keyword">`+`</span> x        <span class="hljs-comment">// [10, 12, 14]</span>

<span class="hljs-string">&#x27;ab&#x27;</span>  <span class="hljs-keyword">+</span>  <span class="hljs-string">&#x27;cd&#x27;</span>   <span class="hljs-comment">// &#x27;abcd&#x27;</span>
<span class="hljs-string">&#x27;ab&#x27;</span> <span class="hljs-keyword">`+</span>  <span class="hljs-string">&#x27;cd&#x27;</span>   <span class="hljs-comment">// [&#x27;acd&#x27;, bcd&#x27;]</span>
<span class="hljs-string">&#x27;ab&#x27;</span> <span class="hljs-keyword">`+`</span> <span class="hljs-string">&#x27;cd&#x27;</span>   <span class="hljs-comment">// [&#x27;ac&#x27;, &#x27;bd&#x27;]</span>
</code></pre>
<p>The many elementwise operators can be used with iterables or non-iterables:</p>
<pre><code class="language-zap"><span class="hljs-keyword">@</span> <span class="hljs-number">4</span> <span class="hljs-number">9</span> <span class="hljs-number">16</span> <span class="hljs-keyword">sqrt</span>   <span class="hljs-comment">// [2, 3, 4]</span>
<span class="hljs-number">4</span> <span class="hljs-keyword">sqrt</span>          <span class="hljs-comment">// 2</span>
</code></pre>
<p>Use <code>class</code> to write a constructor and <code>extends</code> to write a subclass constructor. <code>::</code> gets a property from the prototype of an object so can be used to add methods:</p>
<pre><code class="language-zap"><span class="hljs-comment">// class with empty body: parameters become properties of &#x27;this&#x27;</span>
Cat <span class="hljs-keyword">=</span> <span class="hljs-keyword">class</span> name ()

<span class="hljs-comment">// subclass with empty body: calls constructor of parent class</span>
Lion <span class="hljs-keyword">=</span> <span class="hljs-keyword">extends</span> Cat ()
Lion <span class="hljs-keyword">::</span> <span class="hljs-string">&#x27;speak&#x27;</span> <span class="hljs-keyword">=</span> <span class="hljs-keyword">fun</span> mood
    <span class="hljs-keyword">+</span> <span class="hljs-string">&#x27;I am &#x27;</span><span class="hljs-built_in">this</span><span class="hljs-keyword">,</span>name<span class="hljs-string">&#x27; the &#x27;</span>mood<span class="hljs-string">&#x27; lion&#x27;</span>

leo <span class="hljs-keyword">=</span> <span class="hljs-keyword">new</span> Lion <span class="hljs-string">&#x27;Leo&#x27;</span>   <span class="hljs-comment">// Lion {name: &quot;Leo&quot;}</span>
leo <span class="hljs-keyword">~</span>speak <span class="hljs-string">&#x27;hungry&#x27;</span>    <span class="hljs-comment">// &#x27;I am Leo the hungry lion&#x27;</span>
</code></pre>
<p>Except for <code>class</code> and <code>extends</code>, all operators that take a body operand have an asynchronous version:</p>
<pre><code class="language-zap"><span class="hljs-comment">// prints the length of the data (and returns a promise that</span>
<span class="hljs-comment">// resolves to the length)</span>
<span class="hljs-keyword">asyncScope</span>
    data <span class="hljs-keyword">=</span> <span class="hljs-string">&#x27;data.json&#x27;</span> <span class="hljs-keyword">\</span>fetch <span class="hljs-keyword">await</span> <span class="hljs-keyword">~</span>json <span class="hljs-keyword">await</span>
    data<span class="hljs-keyword">,</span>length <span class="hljs-keyword">print</span>
</code></pre>
<p>DOM operators work with individual HTML/SVG elements, iterables of elements and CSS selector strings:</p>
<pre><code class="language-zap"><span class="hljs-comment">// set color of each span with class danger to red</span>
<span class="hljs-string">&#x27;span.danger&#x27;</span> <span class="hljs-keyword">style</span> <span class="hljs-string">&#x27;color&#x27;</span> <span class="hljs-string">&#x27;red&#x27;</span>
</code></pre>
<p>Data can be encoded as (and is automatically attached to) elements:</p>
<pre><code class="language-zap"><span class="hljs-comment">// add 3 buttons to body, click a button to see its data</span>
<span class="hljs-keyword">@</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-keyword">encode</span> <span class="hljs-string">&#x27;button&#x27;</span> 
| <span class="hljs-keyword">text</span> <span class="hljs-string">&#x27;show data&#x27;</span>
| <span class="hljs-keyword">on</span> <span class="hljs-string">&#x27;click&#x27;</span> [<span class="hljs-built_in">this</span> <span class="hljs-keyword">text</span> a]
| <span class="hljs-keyword">into</span> <span class="hljs-string">&#x27;body&#x27;</span>
</code></pre>
<h2 id="use">Use</h2>
<hr>
<h5>Install</h5>
<pre><code>npm install --save '@gjmcn/zap'</code></pre>
<h5>Load</h5>
<ul>
<li>
<p>CommonJS:</p>
<pre><code>const zap = require('@gjmcn/zap');</code></pre>
</li>
<li>
<p>ES module:</p>
<pre><code>import zap from '@gjmcn/zap';</code></pre>
</li>
<li>
<p>UMD: <code>dist/zap.umd.js</code>. This can be loaded with a <code>&lt;script&gt;</code> tag and will create a global <code>zap</code> function.</p>
</li>
</ul>
<p>Zap can be loaded from a CDN. Examples:</p>
<ul>
<li>
<p><a href="https://www.skypack.dev/">Skypack</a>, using <code>import</code>:</p>
<pre><code>import zap from 'https://cdn.skypack.dev/@gjmcn/zap';</code></pre>
</li>
<li>
<p><a href="https://www.jsdelivr.com/">jsDelivr</a>, using a <code>&lt;script&gt;</code>:</p>
<pre><code>&lt;script src="https://cdn.jsdelivr.net/npm/@gjmcn/zap"&gt;&lt;/script&gt;</code></pre>
</li>
</ul>
<p>The exported <code>zap</code> function compiles a string of Zap code to JavaScript. The optional second argument of <code>zap</code> is an options object that specifies which properties to include in the returned object:</p>
<table class="table table-sm w600">
<thead>
<tr>
<th>Property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>js</code></td>
<td><code>true</code></td>
<td>JavaScript code</td>
</tr>
<tr>
<td><code>sourceMap</code></td>
<td><code>false</code></td>
<td>source map</td>
</tr>
<tr>
<td><code>tokens</code></td>
<td><code>false</code></td>
<td>tokens produced by the lexer</td>
</tr>
<tr>
<td><code>procTokens</code></td>
<td><code>false</code></td>
<td>tokens after processing blocks</td>
</tr>
<tr>
<td><code>jsTree</code></td>
<td><code>false</code></td>
<td>JavaScript tree produced by the parser</td>
</tr>
</tbody>
</table>
<p>When <code>sourceMap</code> is <code>true</code>, add a <code>sourceFile</code> option giving the path to the source file.</p>
<p>The options object can also have an <code>iife</code> property that specifies whether the generated JavaScript should be wrapped in an <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE</a>. This property can be <code>'sync'</code> (synchronous IIFE, the default), <code>'async'</code> (asynchronous IIFE) or <code>'none'</code> (no IIFE). Wrapper IIFEs use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">strict mode</a>.</p>
<p>Zap code compiles to modern JavaScript. Where appropriate, use a transpiler such as <a href="https://babeljs.io/">Babel</a> to ensure compatibility with the target environment(s).</p>
<h4 id="command-line">Command Line</h4>
<blockquote>
<p>The command line app and the REPL are currently very basic with limited functionality.</p>
</blockquote>
<p>Zap can be installed as a command line app:</p>
<pre><code>npm install -g @gjmcn/zap</code></pre>
<p>Use <code>zap</code> with no arguments to start an interactive Zap REPL:</p>
<pre><code>zap</code></pre>
<p>Pass a file path to compile a file. For example, to compile the file <code>index.za</code> to <code>index.js</code> (in the same directory):</p>
<pre><code>zap index.za</code></pre>
<p>Use:</p>
<pre><code>zap --help</code></pre>
<p>to print the command-line options:</p>
<table class="table table-sm w600">
<thead>
<tr>
<th>Short</th>
<th>Long</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td><code>--all</code></td>
<td>Compile all <code>.za</code> files in directory to <code>.js</code> files</td>
</tr>
<tr>
<td><code>-c</code></td>
<td><code>--compile</code></td>
<td>Compile <code>.za</code> file to <code>.js</code> file of same name</td>
</tr>
<tr>
<td><code>-e</code></td>
<td><code>--eval</code></td>
<td>Evaluate a string from the command line</td>
</tr>
<tr>
<td><code>-h</code></td>
<td><code>--help</code></td>
<td>Print help</td>
</tr>
<tr>
<td><code>-i</code></td>
<td><code>--interactive</code></td>
<td>Run an interactive Zap REPL</td>
</tr>
<tr>
<td><code>-m</code></td>
<td><code>--map</code></td>
<td>Generate source map(s), save as <code>.js.map</code> file(s)</td>
</tr>
<tr>
<td><code>-n</code></td>
<td><code>--nodes</code></td>
<td>Print the JavaScript tree produced by the parser</td>
</tr>
<tr>
<td><code>-p</code></td>
<td><code>--print</code></td>
<td>Print the generated JavaScript</td>
</tr>
<tr>
<td><code>-t</code></td>
<td><code>--tokens</code></td>
<td>Print the tokens produced by the lexer</td>
</tr>
<tr>
<td><code>-r</code></td>
<td><code>--proc</code></td>
<td>Print the tokens after processing the blocks</td>
</tr>
<tr>
<td><code>-v</code></td>
<td><code>--version</code></td>
<td>Print version number</td>
</tr>
</tbody>
</table>
<p>Additional information:</p>
<ul>
<li>
<p><code>--all</code> and <code>--compile</code> overwrite existing <code>.js</code> files.</p>
</li>
<li>
<p><code>--map</code> overwrites existing <code>.js.map</code> files. If <code>--all</code> or <code>--compile</code> are used without <code>--map</code>, existing <code>.js.map</code> files (that correspond to the <code>.za</code> files being compiled) are deleted.</p>
</li>
<li>
<p><code>--all</code> is recursive — <code>.za</code> files in subdirectories are compiled.</p>
</li>
<li>
<p><code>--eval</code>, <code>--help</code>, <code>--interactive</code> and <code>--version</code> cannot be combined with other options.</p>
</li>
<li>
<p><code>--map</code> is the only option that can be combined with <code>--all</code>.</p>
</li>
<li>
<p><code>--compile</code>, <code>--map</code>, <code>--nodes</code>, <code>--print</code>, <code>--tokens</code> and <code>--proc</code> can be combined.</p>
</li>
<li>
<p>All file actions are synchronous.</p>
</li>
</ul>
<h4>Code Editors</h4>
<h5><a href="https://code.visualstudio.com/">VS Code</a></h5>
<p>Use the <a href="https://github.com/gjmcn/zap-highlight-vscode">Zap Highlight</a> extension for syntax highlighting. Given the flexibility of operator positioning in Zap, and that only operators 'do things' (functions are called with operators and there are no keywords), a theme that highlights operators differently to all other language elements can help readability. The included <em>Solarized Dark</em> theme and the <em>One Dark Pro</em> extension theme are good examples of this.</p>
<h2 id="basic-syntax">Basic Syntax</h2>
<hr>
<p>Operators are represented by symbols or reserved words. Each line is an expression that returns a value:</p>
<pre><code>2 + 3    // 5
9 sqrt   // 3
</code></pre>
<p>Use <code>|</code> to continue an expression on a new line:</p>
<pre><code>4 + 5
| sqrt   // 3
</code></pre>
<p>In general, Zap does not use operator associativity, position or precedence rules. Code reads left to right and the 'current' operator is applied when the next operator or end of the expression is reached. The result returned by an operator is used as the first operand of the next operator:</p>
<pre><code>+ 2 3   // 5
2 + 3   // 5
2 3 +   // 5

+ 2 3 * 4   // 20
2 + 3 * 4   // 20
2 3 + * 4   // 20
</code></pre>
<blockquote>
<p>If adjacent operators are represented by symbols, they must be separated by whitespace.</p>
</blockquote>
<hr>
<h4 id="parenth-and-indent">Parentheses and Indentation</h4>
<p>Parentheses can be used for precedence:</p>
<pre><code>2 + 3 * 4     // 20
2 + (3 * 4)   // 14
</code></pre>
<p>Parentheses <em>cannot</em> span multiple expressions:</p>
<pre><code>2 + (3 *
| 4)      // 14 (this is a single expression)

(2 + 3
9 sqrt)   // syntax error   
</code></pre>
<p>Indentation can also be used for precedence. Indented blocks <em>can</em> contain multiple expressions:</p>
<pre><code>2 + 
    3 * 4   // 14

2 + 
    x = 3
    x * 4   // 14    
</code></pre>
<p>Opening an indented block automatically continues an expression — do not use a <code>|</code>.</p>
<p>We can close an indented block (or more than one) and continue the expression with <code>|</code>. The following example uses the <a href="#arrays">array literal</a> operator <code>@</code>and the <a href="#objects-and-maps">object literal</a> operator <code>#</code> to create an array-of-objects:</p>
<pre><code>// an array-of-objects
@
    #
    | name 'Alex'
    | best (# score 143 level 2)
| 
    #
    | name 'Cody'
    | best (# score 201 level 3)
</code></pre>
<p>Four spaces must be used for indentation. Use 'soft tabs' in code editors so that tabs are converted to spaces.</p>
<hr>
<h4 id="identifiers">Identifiers</h4>
<p>The term <em>identifier</em> is used frequently in these docs. An identifier is any combination of letters (currently only <code>a</code>-<code>z</code>, <code>A</code>-<code>Z</code>), digits (<code>0</code>-<code>9</code>), <code>_</code> and <code>$</code>, but cannot start with a digit.</p>
<hr>
<h2 id="special-syntax">Special Syntax</h2>
<hr>
<p>Additional syntax rules apply to some operators:</p>
<h4 id="right-operand-rule">The Right Operand Rule</h4>
<p>The <a href="#calling-functions"><code>\</code></a>, <a href="#return-first"><code>&lt;\</code></a> operators (call function), and <a href="#calling-methods"><code>~</code></a>, <a href="#return-first"><code>&lt;~</code></a> operators (call method) use the <em>right operand rule</em>: the first right operand is the function/method. We typically omit space to the right of these operators:</p>
<pre><code>f = [a + b]   // function (adds its arguments)
\f 5 10       // 15
5 \f 10       // 15
5 10 \f       // 15
5 10 f \      // syntax error
</code></pre>
<h4 id="autoquoting">Autoquoting</h4>
<p>The operators <a href="#calling-methods"><code>~</code></a> and <a href="#return-first"><code>&lt;~</code></a> (call method), <a href="#objects-and-maps"><code>#</code></a> (object literal) and <a href="#objects-and-maps"><code>##</code></a> (map literal) <em>autoquote</em> property names that are <a href="#identifiers">identifiers</a>:</p>
<pre><code># 'u' 5 'v' 6   // {u: 5, v: 6}
# u 5 v 6       // {u: 5, v: 6}
</code></pre>
<p>Use the identifier as part of a larger expression (wrapping in parentheses suffices) to avoid autoquoting:</p>
<pre><code>u = 'v'

# 
| u 5
| (u) 6
| (u + 'w') 7   // {u: 5, v: 6, vw: 7}
</code></pre>
<p>The property getter <a href="#comma-getter"><code>,</code></a> autoquotes the property name:</p>
<pre><code>o = # u 5 v 6   // {u: 5, v: 6}
o,u             // 5         
</code></pre>
<p>Operator names are not autoquoted:</p>
<pre><code>o = # 'if' 5   // {if: 5} (quotes required)
o,if           // syntax error
o : 'if'       // 5 (the : property getter has no special behavior)
</code></pre>
<h4 id="getter-precedence">Property Getters</h4>
<p>The <code>,</code> and <code>;</code> property getters have high precedence and can only be used in subexpressions of the form:</p>
<p>  <code><i>variableName</i>[<code>,</code> or <code>;</code>]<i>propertyName1</i>[<code>,</code> or <code>;</code>]<i>propertyName2</i> ...</code></p>
<p>The variable name must be an <a href="#identifiers">identifier</a>. The property name(s) must also follow the identifier rules except that property names <em>can</em> start with a digit.</p>
<p><code>,</code> <a href="#autoquoting">autoquotes</a> the property name whereas <code>;</code> does not. Space and line breaks are not permitted on either side of <code>,</code> or <code>;</code>:</p>
<pre><code>o = # u 5 v (@ 6 7 8)   // {u: 5, v: [6, 7, 8]}
p = 'u'

10 + o,u     // 15
10 + o;p     // 15
10 + o,v;2   // 18
</code></pre>
<p><code>,</code> or <code>;</code> can be used when the property name is an index (e.g. <code>x,100</code> or <code>x;100</code>), but be careful with scientific notation:</p>
<ul>
<li>
<p>Since <code>,</code> autoquotes the property name, <code>x,1e2</code> will get property <code>'1e2'</code> whereas <code>x;1e2</code> will get property <code>100</code>.</p>
</li>
<li>
<p>Do not include <code>+</code> or <code>-</code> in the index. These will not be recognized as part of the property name, so <code>x,1e+2</code> is effectively <code>x,1e + 2</code>, and <code>x;1e+2</code> will throw an error since <code>1e</code> is neither a number nor an <a href="#identifier">identifier</a>.</p>
</li>
</ul>
<h4 id="assignment-precedence">Assignment</h4>
<p><a href="#assignment">Assignment</a> operators have low precedence and must be placed between their two operands:</p>
<pre><code>x = 1 + 2     // 3
x += 3 + 4    // 10
5 + (x = 6)   // 11 (x is 6)
y = x = 8     // syntax error, multiple assignments are not allowed 
</code></pre>
<p><a href="#destructure-object">Destructuring assignment operators</a> must be placed after the last variable being assigned to:</p>
<pre><code>x = @ 5 6
u v @= x   // [5, 6] (u is 5, v is 6)
</code></pre>
<h4 id="body-operands">Body Operands</h4>
<p>The following operators take a <strong>body</strong> operand:</p>
<p><a href="#fun"><code>fun</code></a> <a href="#proc"><code>proc</code></a> <a href="#scope-op"><code>scope</code></a> <a href="#as"><code>as</code></a> <a href="#class"><code>class</code></a> <a href="#extends"><code>extends</code></a> <a href="#each"><code>each</code></a> <a href="#map"><code>map</code></a> <a href="#do"><code>do</code></a> <a href="#try"><code>try</code></a> <a href="#catch"><code>catch</code></a></p>
<p><a href="#fun"><code>asyncFun</code></a> <a href="#proc"><code>asyncProc</code></a> <a href="#scope-op"><code>asyncScope</code></a> <a href="#as"><code>asyncAs</code></a> <a href="#async-loops"><code>asyncEach</code></a> <a href="#async-loops"><code>asyncMap</code></a> <a href="#async-loops"><code>asyncDo</code></a> <a href="#try"><code>asyncTry</code></a> <a href="#catch"><code>asyncCatch</code></a></p>
<p>The body is always the final operand and must be in parentheses or be an indented block. Also, the body cannot be before the operator:</p>
<pre><code>fun x y
    x + y         // function

fun x y (x + y)   // function

x y fun (x + y)   // function

x y (x + y) fun   // syntax error, missing body
</code></pre>
<p>Body operands are important for the following reasons:</p>
<ul>
<li>
<p>They dictate the visibility of variables — see <a href="#local-variables">Local Variables</a>.</p>
</li>
<li>
<p><code>await</code> can only be used in the body of one of the asynchronous operators listed above.</p>
</li>
<li>
<p><code>yield</code> and <code>yieldFrom</code> can only be used in the body of <code>fun</code>, <code>scope</code>, <code>as</code>, <code>each</code> and <code>do</code> (and their asynchronous counterparts).</p>
</li>
<li>
<p><code>stop</code> (exit a loop) can only be used in the body of <code>each</code>, <code>map</code> and <code>do</code> loops (and their asynchronous counterparts).</p>
</li>
</ul>
<h2 id="operators">Operators</h2>
<hr>
<h4>Symbols</h4>
<table class="table table-sm w600">
<thead>
<tr>
<th>Operator</th>
<th>Arity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code> <code>-</code></td>
<td>1+</td>
<td>unary plus/minus, add, subtract</td>
</tr>
<tr>
<td><code>*</code> <code>/</code> <code>%</code> <code>^</code></td>
<td>2+</td>
<td>multiply, divide, remainder, exponentiate</td>
</tr>
<tr>
<td><code>&lt;&gt;</code> <code>&gt;&lt;</code></td>
<td>2+</td>
<td>least, greatest</td>
</tr>
<tr>
<td><code>&amp;&amp;</code> `</td>
<td></td>
<td><code> </code>??`</td>
</tr>
<tr>
<td><a href="#ternary"><code>?</code></a></td>
<td>2-3</td>
<td>conditional</td>
</tr>
<tr>
<td><code>!</code></td>
<td>1</td>
<td>logical not</td>
</tr>
<tr>
<td><code>&lt;</code> <code>&lt;=</code> <code>&gt;</code> <code>&gt;=</code></td>
<td>2</td>
<td>compare</td>
</tr>
<tr>
<td><code>==</code> <code>!=</code></td>
<td>2</td>
<td>strict equality, strict inequality</td>
</tr>
<tr>
<td><a href="#standard-assignment"><code>=</code></a></td>
<td>2</td>
<td>assign</td>
</tr>
<tr>
<td><a href="#non-local"><code>\=</code></a></td>
<td>2</td>
<td>assign, do not trigger creation of local variable</td>
</tr>
<tr>
<td><a href="#options"><code>&lt;-</code></a></td>
<td>2</td>
<td>assign, use option of same name or default</td>
</tr>
<tr>
<td><a href="#conditional-assignment"><code>?=</code></a></td>
<td>2</td>
<td>conditional assign</td>
</tr>
<tr>
<td><a href="#update-assignment"><code>+=</code></a> <a href="#update-assignment"><code>-=</code></a> <a href="#update-assignment"><code>*=</code></a> <a href="#update-assignment"><code>/=</code></a> <a href="#update-assignment"><code>%=</code></a> <a href="#update-assignment"><code>^=</code></a></td>
<td>2</td>
<td>update-assign</td>
</tr>
<tr>
<td><a href="#destructure-object"><code>#=</code></a></td>
<td>2+</td>
<td>destructure object</td>
</tr>
<tr>
<td><a href="#destructure-iterable"><code>@=</code></a></td>
<td>2+</td>
<td>destructure array</td>
</tr>
<tr>
<td><a href="#comma-getter"><code>,</code></a></td>
<td>2</td>
<td>get property (high precedence, autoquote)</td>
</tr>
<tr>
<td><a href="#comma-getter"><code>;</code></a></td>
<td>2</td>
<td>get property (high precedence)</td>
</tr>
<tr>
<td><a href="#colon-getter"><code>:</code></a></td>
<td>2</td>
<td>get property</td>
</tr>
<tr>
<td><a href="#colon-proto-getter"><code>::</code></a></td>
<td>2</td>
<td>get property of prototype</td>
</tr>
<tr>
<td><a href="#conditional-get"><code>?:</code></a></td>
<td>2</td>
<td>conditional get property</td>
</tr>
<tr>
<td><a href="#calling-functions"><code>\</code></a></td>
<td>1+</td>
<td>call function</td>
</tr>
<tr>
<td><a href="#return-first"><code>&lt;\</code></a></td>
<td>2+</td>
<td>call function, return first argument</td>
</tr>
<tr>
<td><a href="#calling-methods"><code>~</code></a></td>
<td>2+</td>
<td>call method</td>
</tr>
<tr>
<td><a href="#return-first"><code>&lt;~</code></a></td>
<td>2+</td>
<td>call method, return calling object</td>
</tr>
<tr>
<td><a href="#objects-and-maps"><code>#</code></a></td>
<td>0+</td>
<td>object literal</td>
</tr>
<tr>
<td><a href="#objects-and-maps"><code>##</code></a></td>
<td>0+</td>
<td>map literal</td>
</tr>
<tr>
<td><a href="#arrays"><code>@</code></a></td>
<td>0+</td>
<td>array literal</td>
</tr>
<tr>
<td><a href="#sets"><code>@@</code></a></td>
<td>0+</td>
<td>set literal</td>
</tr>
</tbody>
</table>
<p>The operators <code>&amp;&amp;</code>, <code>||</code>, <code>??</code>, <code>?</code>, <code>&lt;-</code>, <code>?=</code> and <code>?:</code> use short-circuit evaluation.</p>
<hr>
<h4>JavaScript Operators</h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await"><code>await</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/delete"><code>delete</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/in"><code>in</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/instanceof"><code>instanceof</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new"><code>new</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/typeof"><code>typeof</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/yield"><code>yield</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/yield*"><code>yieldFrom</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/void"><code>void</code></a></p>
<p>These operators behave the same as their JavaScript counterparts except that:</p>
<ul>
<li><code>delete</code> takes two operands: an object and a property name:</li>
</ul>
<pre><code class="indent">o = # u 5 v 6
o delete 'u'    // true
o               // {v: 6}
</code></pre>
<ul>
<li>The operands of <code>new</code> are a constructor and arguments to pass to the constructor (the constructor is not called explicitly):</li>
</ul>
<pre><code class="indent">new Date           // current local date and time
new Date '2050'    // 01 January 2050, 00:00:00
new Date 2050 11   // 01 December, 2050, 00:00:00
</code></pre>
<ul>
<li>JavaScript's <code>yield*</code> is called <code>yieldFrom</code> in Zap.</li>
</ul>
<hr>
<h4>Body</h4>
<p><a href="#as"><code>as</code></a> <a href="#catch"><code>catch</code></a> <a href="#class"><code>class</code></a> <a href="#do"><code>do</code></a> <a href="#each"><code>each</code></a> <a href="#extends"><code>extends</code></a> <a href="#fun"><code>fun</code></a> <a href="#map"><code>map</code></a> <a href="#proc"><code>proc</code></a> <a href="#scope-op"><code>scope</code></a> <a href="#try"><code>try</code></a></p>
<p><a href="#as"><code>asyncAs</code></a> <a href="#catch"><code>asyncCatch</code></a> <a href="#async-loops"><code>asyncDo</code></a> <a href="#async-loops"><code>asyncEach</code></a> <a href="#fun"><code>asyncFun</code></a> <a href="#async-loops"><code>asyncMap</code></a> <a href="#proc"><code>asyncProc</code></a> <a href="#scope-op"><code>asyncScope</code></a> <a href="#try"><code>asyncTry</code></a></p>
<hr>
<h4>Elementwise Math</h4>
<p><a href="#elementwise"><code>abs</code></a> <a href="#elementwise"><code>acos</code></a> <a href="#elementwise"><code>acosh</code></a> <a href="#elementwise"><code>asin</code></a> <a href="#elementwise"><code>asinh</code></a> <a href="#elementwise"><code>atan</code></a> <a href="#elementwise"><code>atanh</code></a> <a href="#elementwise"><code>cbrt</code></a> <a href="#elementwise"><code>ceil</code></a> <a href="#elementwise"><code>clz32</code></a> <a href="#elementwise"><code>cos</code></a> <a href="#elementwise"><code>cosh</code></a> <a href="#elementwise"><code>exp</code></a> <a href="#elementwise"><code>expm1</code></a> <a href="#elementwise"><code>floor</code></a> <a href="#elementwise"><code>fround</code></a> <a href="#elementwise"><code>log</code></a> <a href="#elementwise"><code>log10</code></a> <a href="#elementwise"><code>log1p</code></a>  <a href="#elementwise"><code>log2</code></a> <a href="#elementwise"><code>round</code></a> <a href="#elementwise"><code>sign</code></a> <a href="#elementwise"><code>sin</code></a> <a href="#elementwise"><code>sinh</code></a> <a href="#elementwise"><code>sqrt</code></a> <a href="#elementwise"><code>tan</code></a> <a href="#elementwise"><code>tanh</code></a> <a href="#elementwise"><code>trunc</code></a></p>
<hr>
<h4>Elementwise Other</h4>
<p><a href="#elementwise"><code>boolean</code></a> <a href="#elementwise"><code>date</code></a> <a href="#elementwise"><code>neg</code></a> <a href="#elementwise"><code>not</code></a> <a href="#elementwise"><code>number</code></a> <a href="#elementwise"><code>string</code></a> <a href="#elementwise"><code>toLowerCase</code></a> <a href="#elementwise"><code>toUpperCase</code></a> <a href="#elementwise"><code>trim</code></a> <a href="#elementwise"><code>trimEnd</code></a> <a href="#elementwise"><code>trimStart</code></a></p>
<hr>
<h4>Filter, Group, Reduce, Sort</h4>
<p><a href="#bin"><code>bin</code></a>  <a href="#bin"><code>binCount</code></a> <a href="#count"><code>count</code></a> <a href="#correlation"><code>correlation</code></a> <a href="#correlation"><code>covariance</code></a> <a href="#correlation"><code>covariancePop</code></a> <a href="#sum"><code>deviation</code></a> <a href="#sum"><code>deviationPop</code></a> <a href="#every"><code>every</code></a> <a href="#filter"><code>filter</code></a> <a href="#filter"><code>filterIndex</code></a> <a href="#find"><code>find</code></a> <a href="#find"><code>findIndex</code></a> <a href="#group"><code>group</code></a> <a href="#group"><code>groupCount</code></a> <a href="#min"><code>max</code></a> <a href="#min"><code>maxIndex</code></a> <a href="#sum"><code>mean</code></a> <a href="#median"><code>median</code></a> <a href="#min"><code>min</code></a> <a href="#min"><code>minIndex</code></a> <a href="#order"><code>order</code></a> <a href="#order"><code>orderIndex</code></a> <a href="#median"><code>quantile</code></a> <a href="#reduce-op"><code>reduce</code></a> <a href="#every"><code>some</code></a> <a href="#sum"><code>sum</code></a> <a href="#sum-cumu"><code>sumCumu</code></a> <a href="#order"><code>rank</code></a> <a href="#sum"><code>variance</code></a> <a href="#sum"><code>variancePop</code></a></p>
<hr>
<h4>Get/Set Property</h4>
<p><a href="#copy-properties"><code>assign</code></a> <a href="#at"><code>at</code></a> <a href="#attach"><code>attach</code></a> <a href="#chg"><code>chg</code></a> <a href="#getter"><code>getter</code></a> <a href="#setter"><code>setter</code></a></p>
<hr>
<h4>Import and Export</h4>
<p><a href="#export"><code>export</code></a> <a href="#import"><code>import</code></a> <a href="#import-all"><code>importAll</code></a> <a href="#import-as"><code>importAs</code></a> <a href="#import-default"><code>importDefault</code></a> <a href="#load"><code>load</code></a></p>
<hr>
<h4>Is</h4>
<p><a href="#is"><code>isArray</code></a> <a href="#is"><code>isBigInt</code></a> <a href="#is"><code>isBoolean</code></a> <a href="#is"><code>isFinite</code></a> <a href="#is"><code>isFunction</code></a> <a href="#is"><code>isInteger</code></a> <a href="#is"><code>isNaN</code></a> <a href="#is"><code>isNull</code></a> <a href="#is"><code>isNullish</code></a> <a href="#is"><code>isNumber</code></a> <a href="#is"><code>isString</code></a> <a href="#is"><code>isSymbol</code></a> <a href="#is"><code>isUndefined </code></a></p>
<hr>
<h4>Joins</h4>
<p><a href="#semi-join"><code>antiJoin</code></a> <a href="#cross-join"><code>crossJoin</code></a> <a href="#crush"><code>crush</code></a> <a href="#inner-join"><code>innerJoin</code></a> <a href="#inner-join"><code>leftJoin</code></a> <a href="#inner-join"><code>outerJoin</code></a> <a href="#inner-join"><code>rightJoin</code></a> <a href="#semi-join"><code>semiJoin</code></a></p>
<hr>
<h4>Nested Data</h4>
<p><a href="#array-of-objects"><code>arrObj</code></a> <a href="#map-at"><code>mapAt</code></a> <a href="#object-of-arrays"><code>objArr</code></a> <a href="#pick"><code>pick</code></a> <a href="#transpose"><code>transpose</code></a></p>
<hr>
<h4>Other</h4>
<p><a href="#arrays"><code>array</code></a> <a href="#call-and-apply"><code>apply</code></a> <a href="#call-and-apply"><code>call</code></a> <a href="#debugger"><code>debugger</code></a> <a href="#arrays"><code>empties</code></a> <a href="#if"><code>if</code></a> <a href="#lin-space"><code>linSpace</code></a> <a href="#arrays"><code>ones</code></a> <a href="#period"><code>period</code></a> <a href="#print"><code>print</code></a> <a href="#throw"><code>throw</code></a> <a href="#to"><code>to</code></a> <a href="#arrays"><code>zeros</code></a> <a href="#interpolate"><code>interpolate</code></a></p>
<hr>
<h4>Random and Shuffle</h4>
<p><a href="#binomial"><code>binomial</code></a> <a href="#categorical"><code>categorical</code></a> <a href="#exponential"><code>exponential</code></a> <a href="#geometric"><code>geometric</code></a> <a href="#log-normal"><code>logNormal</code></a> <a href="#normal"><code>normal</code></a> <a href="#random-op"><code>random</code></a> <a href="#random-int"><code>randomInt</code></a> <a href="#shuffle"><code>shuffle</code></a></p>
<hr>
<h4>Set Theory</h4>
<p><a href="#set-theory"><code>difference</code></a> <a href="#set-theory"><code>intersection</code></a> <a href="#set-theory"><code>union</code></a></p>
<hr>
<h4>DOM</h4>
<p><a href="#add-class"><code>addClass</code></a> <a href="#attr"><code>attr</code></a> <a href="#create"><code>create</code></a> <a href="#create"><code>createSVG</code></a> <a href="#encode"><code>encode</code></a> <a href="#encode"><code>encodeSVG</code></a> <a href="#fragment"><code>fragment</code></a> <a href="#has-attr"><code>hasAttr</code></a> <a href="#has-attr"><code>hasClass</code></a> <a href="#html"><code>html</code></a> <a href="#insert"><code>insert</code></a> <a href="#insert-each"><code>insertEach</code></a> <a href="#into"><code>into</code></a> <a href="#lower"><code>lower</code></a> <a href="#on"><code>off</code></a> <a href="#on"><code>on</code></a> <a href="#attr"><code>prop</code></a> <a href="#lower"><code>raise</code></a> <a href="#remove"><code>remove</code></a> <a href="#remove-attr"><code>removeAttr</code></a> <a href="#add-class"><code>removeClass</code></a> <a href="#remove-attr"><code>removeStyle</code></a> <a href="#select"><code>select</code></a> <a href="#select-all"><code>selectAll</code></a> <a href="#sketch"><code>sketch</code></a> <a href="#attr"><code>style</code></a> <a href="#html"><code>text</code></a> <a href="#toggle-class"><code>toggleClass</code></a></p>
<h5>HTML Elements</h5>
<p><a href="#create-convenience"><code>$a</code></a> <a href="#create-convenience"><code>$abbr</code></a> <a href="#create-convenience"><code>$address</code></a> <a href="#create-convenience"><code>$area</code></a> <a href="#create-convenience"><code>$article</code></a> <a href="#create-convenience"><code>$aside</code></a> <a href="#create-convenience"><code>$audio</code></a> <a href="#create-convenience"><code>$b</code></a> <a href="#create-convenience"><code>$base</code></a> <a href="#create-convenience"><code>$bdi</code></a> <a href="#create-convenience"><code>$bdo</code></a> <a href="#create-convenience"><code>$blockquote</code></a> <a href="#create-convenience"><code>$body</code></a> <a href="#create-convenience"><code>$br</code></a> <a href="#create-convenience"><code>$button</code></a> <a href="#create-convenience"><code>$canvas</code></a> <a href="#create-convenience"><code>$caption</code></a> <a href="#create-convenience"><code>$cite</code></a> <a href="#create-convenience"><code>$code</code></a> <a href="#create-convenience"><code>$col</code></a> <a href="#create-convenience"><code>$colgroup</code></a> <a href="#create-convenience"><code>$data</code></a> <a href="#create-convenience"><code>$datalist</code></a> <a href="#create-convenience"><code>$dd</code></a> <a href="#create-convenience"><code>$del</code></a> <a href="#create-convenience"><code>$details</code></a> <a href="#create-convenience"><code>$dfn</code></a> <a href="#create-convenience"><code>$dialog</code></a> <a href="#create-convenience"><code>$div</code></a> <a href="#create-convenience"><code>$dl</code></a> <a href="#create-convenience"><code>$dt</code></a> <a href="#create-convenience"><code>$em</code></a> <a href="#create-convenience"><code>$embed</code></a> <a href="#create-convenience"><code>$fieldset</code></a> <a href="#create-convenience"><code>$figcaption</code></a> <a href="#create-convenience"><code>$figure</code></a> <a href="#create-convenience"><code>$footer</code></a> <a href="#create-convenience"><code>$form</code></a> <a href="#create-convenience"><code>$h1</code></a> <a href="#create-convenience"><code>$h2</code></a> <a href="#create-convenience"><code>$h3</code></a> <a href="#create-convenience"><code>$h4</code></a> <a href="#create-convenience"><code>$h5</code></a> <a href="#create-convenience"><code>$h6</code></a> <a href="#create-convenience"><code>$head</code></a> <a href="#create-convenience"><code>$header</code></a> <a href="#create-convenience"><code>$hgroup</code></a> <a href="#create-convenience"><code>$hr</code></a> <a href="#create-convenience"><code>$i</code></a> <a href="#create-convenience"><code>$iframe</code></a> <a href="#create-convenience"><code>$img</code></a> <a href="#create-convenience"><code>$input</code></a> <a href="#create-convenience"><code>$ins</code></a> <a href="#create-convenience"><code>$kbd</code></a> <a href="#create-convenience"><code>$label</code></a> <a href="#create-convenience"><code>$legend</code></a> <a href="#create-convenience"><code>$li</code></a> <a href="#create-convenience"><code>$link</code></a> <a href="#create-convenience"><code>$main</code></a> <a href="#create-convenience"><code>$map</code></a> <a href="#create-convenience"><code>$mark</code></a> <a href="#create-convenience"><code>$menu</code></a> <a href="#create-convenience"><code>$meta</code></a> <a href="#create-convenience"><code>$meter</code></a> <a href="#create-convenience"><code>$nav</code></a> <a href="#create-convenience"><code>$noscript</code></a> <a href="#create-convenience"><code>$object</code></a> <a href="#create-convenience"><code>$ol</code></a> <a href="#create-convenience"><code>$optgroup</code></a> <a href="#create-convenience"><code>$option</code></a> <a href="#create-convenience"><code>$output</code></a> <a href="#create-convenience"><code>$p</code></a> <a href="#create-convenience"><code>$param</code></a> <a href="#create-convenience"><code>$picture</code></a> <a href="#create-convenience"><code>$pre</code></a> <a href="#create-convenience"><code>$progress</code></a> <a href="#create-convenience"><code>$q</code></a> <a href="#create-convenience"><code>$rb</code></a> <a href="#create-convenience"><code>$rp</code></a> <a href="#create-convenience"><code>$rt</code></a> <a href="#create-convenience"><code>$rtc</code></a> <a href="#create-convenience"><code>$ruby</code></a> <a href="#create-convenience"><code>$s</code></a> <a href="#create-convenience"><code>$samp</code></a> <a href="#create-convenience"><code>$script</code></a> <a href="#create-convenience"><code>$section</code></a> <a href="#create-convenience"><code>$select</code></a> <a href="#create-convenience"><code>$slot</code></a> <a href="#create-convenience"><code>$small</code></a> <a href="#create-convenience"><code>$source</code></a> <a href="#create-convenience"><code>$span</code></a> <a href="#create-convenience"><code>$strong</code></a> <a href="#create-convenience"><code>$style</code></a> <a href="#create-convenience"><code>$sub</code></a> <a href="#create-convenience"><code>$summary</code></a> <a href="#create-convenience"><code>$sup</code></a> <a href="#create-convenience"><code>$table</code></a> <a href="#create-convenience"><code>$tbody</code></a> <a href="#create-convenience"><code>$td</code></a> <a href="#create-convenience"><code>$template</code></a> <a href="#create-convenience"><code>$textarea</code></a> <a href="#create-convenience"><code>$tfoot</code></a> <a href="#create-convenience"><code>$th</code></a> <a href="#create-convenience"><code>$thead</code></a> <a href="#create-convenience"><code>$time</code></a> <a href="#create-convenience"><code>$title</code></a> <a href="#create-convenience"><code>$tr</code></a> <a href="#create-convenience"><code>$track</code></a> <a href="#create-convenience"><code>$u</code></a> <a href="#create-convenience"><code>$ul</code></a> <a href="#create-convenience"><code>$var</code></a> <a href="#create-convenience"><code>$video</code></a> <a href="#create-convenience"><code>$wbr</code></a></p>
<h5>SVG Elements</h5>
<p><a href="#create-convenience"><code>$animate</code></a> <a href="#create-convenience"><code>$animateMotion</code></a> <a href="#create-convenience"><code>$animateTransform</code></a> <a href="#create-convenience"><code>$circle</code></a> <a href="#create-convenience"><code>$clipPath</code></a> <a href="#create-convenience"><code>$defs</code></a> <a href="#create-convenience"><code>$desc</code></a> <a href="#create-convenience"><code>$discard</code></a> <a href="#create-convenience"><code>$ellipse</code></a> <a href="#create-convenience"><code>$feBlend</code></a> <a href="#create-convenience"><code>$feColorMatrix</code></a> <a href="#create-convenience"><code>$feComponentTransfer</code></a> <a href="#create-convenience"><code>$feComposite</code></a> <a href="#create-convenience"><code>$feConvolveMatrix</code></a> <a href="#create-convenience"><code>$feDiffuseLighting</code></a> <a href="#create-convenience"><code>$feDisplacementMap</code></a> <a href="#create-convenience"><code>$feDistantLight</code></a> <a href="#create-convenience"><code>$feDropShadow</code></a> <a href="#create-convenience"><code>$feFlood</code></a> <a href="#create-convenience"><code>$feFuncA</code></a> <a href="#create-convenience"><code>$feFuncB</code></a> <a href="#create-convenience"><code>$feFuncG</code></a> <a href="#create-convenience"><code>$feFuncR</code></a> <a href="#create-convenience"><code>$feGaussianBlur</code></a> <a href="#create-convenience"><code>$feImage</code></a> <a href="#create-convenience"><code>$feMerge</code></a> <a href="#create-convenience"><code>$feMergeNode</code></a> <a href="#create-convenience"><code>$feMorphology</code></a> <a href="#create-convenience"><code>$feOffset</code></a> <a href="#create-convenience"><code>$fePointLight</code></a> <a href="#create-convenience"><code>$feSpecularLighting</code></a> <a href="#create-convenience"><code>$feSpotLight</code></a> <a href="#create-convenience"><code>$feTile</code></a> <a href="#create-convenience"><code>$feTurbulence</code></a> <a href="#create-convenience"><code>$filter</code></a> <a href="#create-convenience"><code>$foreignObject</code></a> <a href="#create-convenience"><code>$g</code></a> <a href="#create-convenience"><code>$hatch</code></a> <a href="#create-convenience"><code>$hatchpath</code></a> <a href="#create-convenience"><code>$image</code></a> <a href="#create-convenience"><code>$line</code></a> <a href="#create-convenience"><code>$linearGradient</code></a> <a href="#create-convenience"><code>$marker</code></a> <a href="#create-convenience"><code>$mask</code></a> <a href="#create-convenience"><code>$metadata</code></a> <a href="#create-convenience"><code>$mpath</code></a> <a href="#create-convenience"><code>$path</code></a> <a href="#create-convenience"><code>$pattern</code></a> <a href="#create-convenience"><code>$polygon</code></a> <a href="#create-convenience"><code>$polyline</code></a> <a href="#create-convenience"><code>$radialGradient</code></a> <a href="#create-convenience"><code>$rect </code></a> <a href="#create-convenience"><code>$set</code></a> <a href="#create-convenience"><code>$solidcolor</code></a> <a href="#create-convenience"><code>$stop</code></a> <a href="#create-convenience"><code>$svg</code></a> <a href="#create-convenience"><code>$switch</code></a> <a href="#create-convenience"><code>$symbol</code></a> <a href="#create-convenience"><code>$text</code></a> <a href="#create-convenience"><code>$textPath</code></a> <a href="#create-convenience"><code>$tspan</code></a> <a href="#create-convenience"><code>$use</code></a> <a href="#create-convenience"><code>$view</code></a></p>
<h2 id="literals">Literals</h2>
<hr>
<h4>Basics</h4>
<pre><code>5           // 5 (number)
5.6         // 5.6 (number)
5e-2        // 0.05 (number)
'abc'       // 'abc' (string)
&quot;abc&quot;       // 'abc' (string)
&quot;a
bc&quot;         // 'a\nbc' (&quot;...&quot; strings can be multiline)
&amp;/abc/      // /abc/ (regular expression)
false       // false (boolean)
null        // null
undefined   // undefined
</code></pre>
<hr>
<h4 id="objects-and-maps">Objects and Maps</h4>
<p>Use the <code>#</code> operator for an object, and <code>##</code> for a map:</p>
<pre><code>#             // empty object
# u 5 v 6     // {u: 5, v: 6}

##            // empty map
## u 5 v 6    // Map {'u' =&gt; 5, 'v' =&gt; 6}
</code></pre>
<p><code>#</code> and <code>##</code> use <a href="#autoquoting">autoquoting</a>, which is why the property names in the above examples need not be quoted.</p>
<hr>
<h4 id="arrays">Arrays</h4>
<p>Use the <code>@</code> operator for an array:</p>
<pre><code>@       // empty array
@ 5 6   // [5, 6]
</code></pre>
<p>The <code>array</code> operator is like <code>@</code>, except that if an operand is a non-string iterable, <code>array</code> uses the elements of the iterable rather than the iterable itself:</p>
<pre><code>i = 2         // 2
s = '34'      // '34'
x = @ 5 6 7   // [5, 6, 7] 
y = @@ 8 9    // Set {8, 9} (see below)

array     // empty array
i array   // [2]   
s array   // ['34']  
x array   // [5, 6, 7]
y array   // [8, 9]

i s x y @       // [2, '34', [5, 6, 7], Set {8, 9}]
i s x y array   // [2, '34', 5, 6, 7, 8, 9]

// array does not 'flatten' iterables recursively
z = @ 2 (@ 3 4)   // [2, [3, 4]]
1 z array         // [1, 2, [3, 4]] 
</code></pre>
<p><code>empties</code>, <code>zeros</code> and <code>ones</code> create an array of a given length. <code>zeros</code> and <code>ones</code> set each entry to <code>0</code> or <code>1</code>. Include additional operands to create nested arrays:</p>
<pre><code>3 empties    // [empty x 3]
2 3 zeros    // [[0, 0, 0], [0, 0, 0]]
2 3 2 ones   // [
             //   [[1, 1], [1, 1], [1, 1]],
             //   [[1, 1], [1, 1], [1, 1]]]
             // ]
</code></pre>
<hr>
<h4 id="sets">Sets</h4>
<p>Use the <code>@@</code> operator for a set:</p>
<pre><code>@@       // empty set
@@ 5 6   // Set {5, 6}
</code></pre>
<p>Note that <code>@@</code> interprets each operand as an element, whereas the <code>Set</code> constructor extracts elements from an iterable:</p>
<pre><code>@@ 'ab'        // Set {'ab'}
new Set 'ab'   // Set {'a', 'b'}
</code></pre>
<h2 id="calling-functions">Calling Functions</h2>
<hr>
<p>The <code>\</code> operator calls a function. <code>\</code> uses the <a href="#right-operand-rule">right operand rule</a>:</p>
<pre><code>f = [a + b]   // function (adds its arguments)
\f 5 10       // 15 
5 \f 10       // 15
5 10 \f       // 15
</code></pre>
<p>The behavior of <code>\</code> allows us to 'pipe' function calls rather than nest them:</p>
<pre><code>double = [2 * a]      // function
add = [a + b]         // function
\double 5 \add 20     // 30 (piped calls)
\add (\double 5) 20   // 30 (nested calls)
</code></pre>
<hr>
<h4 id="calling-methods">Methods</h4>
<p><code>\</code> can be used to call methods, but there is also a dedicated method call operator <code>~</code> which is often more convenient. <code>~</code> uses the <a href="#right-operand-rule">right operand rule</a> and <a href="#autoquoting">autoquoting</a>:</p>
<pre><code>x = @ 5 6 7 8
x ~slice 1 3   // [6, 7]
~slice x 1 3   // [6, 7]
x 1 3 ~slice   // [6, 7]
\x,slice 1 3   // [6, 7]

JSON ~stringify x   // '[5,6,7,8]'
\JSON,stringify x   // '[5,6,7,8]'
x \JSON,stringify   // '[5,6,7,8]'
</code></pre>
<hr>
<h4 id="return-first">Return Calling Object or First Argument</h4>
<p><code>&lt;~</code> is like <code>~</code>, but <code>&lt;~</code> always returns the calling object. For example, we can use <code>&lt;~</code> to chain the array methods <code>push</code> and <code>shift</code> (neither of which return the calling array):</p>
<pre><code>@ 5 6 &lt;~push 7 &lt;~shift   // [6, 7]
</code></pre>
<p>Similarly, <code>&lt;\</code> is like the function call operator <code>\</code>, but <code>&lt;\</code> returns the first argument passed to the function.</p>
<hr>
<h4 id="call-and-apply"><code>call</code> and <code>apply</code></h4>
<p>Call a function.</p>
<p>The first operand of <code>call</code> must be a function; any other operands are passed to the function:</p>
<pre><code>f = [a + b]   // function (adds its arguments)
call f 5 10   // 15 
f call 5 10   // 15
</code></pre>
<p><code>apply</code> is like <code>call</code>, but any arguments for the function are passed inside a single iterable:</p>
<pre><code>f = [a + b]        // function (adds its arguments)
f apply (@ 5 10)   // 15
apply f (@ 5 10)   // 15
</code></pre>
<blockquote>
<p><code>call</code> and <code>apply</code> are like the function methods <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call"><code>call</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply"><code>apply</code></a> respectively, but the Zap operators do not specify the value of <code>this</code>. Also, the <code>apply</code> operator can take any iterable, whereas the <code>apply</code> method is restricted to array-like objects.</p>
</blockquote>
<h2 id="assignment">Assignment</h2>
<hr>
<blockquote>
<p>Assignment operators <a href="#assignment-precedence">do not follow the normal position and precedence rules</a>.</p>
</blockquote>
<hr>
<h4 id="standard-assignment"><code>=</code></h4>
<p>Standard assignment:</p>
<pre><code>x = 5   // 5
x       // 5
</code></pre>
<hr>
<h4 id="non-local"><code>\=</code></h4>
<p>Assign, but do not trigger the creation of a local variable (see <a href="#local-variables">Local Variables</a>):</p>
<pre><code>x = 5         // 5
scope
    x         // 5
    x \= 10   // 10
    x         // 10
x             // 10
</code></pre>
<hr>
<h4 id="update-assignment"><code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>, <code>^=</code></h4>
<p>Update-assignment:</p>
<pre><code>x = 5     // 5
x += 10   // 15
x         // 15
</code></pre>
<hr>
<h4 id="conditional-assignment"><code>?=</code></h4>
<p>Use <code>?=</code> for <em>conditional assignment</em>: if the variable (the first operand) is currently <code>undefined</code> or <code>null</code>, the second operand is evaluated and the result is assigned to the variable. If the variable <em>is not</em> currently <code>undefined</code> or <code>null</code>, the variable is assigned its current value and the second operand is not evaluated (short-circuit evaluation):</p>
<pre><code>x = null
x ?= 5    // 5 (x is 5)
x ?= 10   // 5 (x is 5)
</code></pre>
<hr>
<h4 id="destructure-object"><code>#=</code></h4>
<p>Destructure an object:</p>
<pre><code>o = # h 5 i 6 j 7
h j z #= o   // returns o, h is 5, j is 7, z is undefined
</code></pre>
<hr>
<h4 id="destructure-iterable"><code>@=</code></h4>
<p>Destructure an iterable:</p>
<pre><code>x = @ 5 6 7
u v @= x       // returns x, u is 5, v is 6
u v w z @= x   // returns x, u is 5, v is 6, w is 7, z is undefined
</code></pre>
<hr>
<h4 id="local-variables">Local Variables</h4>
<p>Assignment triggers the creation of a local variable. The variable is created at the start of the current <a href="#body-operands">body</a> (or start of the file if not inside a body), and has the value <code>undefined</code> until it is assigned to. The following example uses the <a href="#scope-op"><code>scope</code></a> operator:</p>
<pre><code>x = 5        // 5 (outer x)

scope
    x        // 5 (outer x)

// assign to x in the body of scope so a local x is created
scope
    x        // undefined (local x)
    x = 10   // 10 (local x)
    x        // 10 (local x)

x            // 5 (outer x)
</code></pre>
<p>Using the default compiler options (see <a href="#use">Use</a>), variables created outside of a body are <em>not</em> global — i.e. they are not visible to other files. <a href="#set-property">Set a property</a> of the global object to create a global variable:</p>
<pre><code>globalThis,x = 5   // works in any JavaScript environment
window,y = 6       // works in browsers
global,z = 7       // works in Node.js
</code></pre>
<p>Only <a href="#standard-assignment"><code>=</code></a>, <a href="#destructure-object"><code>#=</code></a>, <a href="#destructure-iterable"><code>@=</code></a> and <a href="#options"><code>&lt;-</code></a> (discussed in <a href="#writing-functions">Writing Functions</a>) trigger the creation of local variables. The other assignment operators change the value of an existing variable.</p>
<h2 id="get-property">Get Property</h2>
<hr>
<h4 id="comma-getter"><code>,</code>, <code>;</code></h4>
<p>Get an object/array property or a character from a string. These operators have <a href="#getter-precedence">special behavior</a> including high precedence. <code>,</code> <a href="#autoquoting">autoquotes</a> the property name whereas <code>;</code> does not:</p>
<pre><code>circle = #
| radius 50
| center (@ 100 200)
| color 'red'

r = 'radius'

circle,radius     // 50
circle;r          // 50
circle,center,1   // 200   
circle,color,2    // 'd'
</code></pre>
<hr>
<h4 id="colon-getter"><code>:</code></h4>
<p>Get an object/array property or a character from a string:</p>
<pre><code>circle = #
| radius 50
| center (@ 100 200)
| color 'red'

r = 'radius'

circle : 'radius'          // 50
circle : r                 // 50
circle : ('rad' + 'ius')   // 50
circle : 'center' : 1      // 200   
circle : 'color' : 2       // 'd'
</code></pre>
<hr>
<h4 id="colon-proto-getter"><code>::</code></h4>
<p>As <a href="#colon-getter"><code>:</code></a>, but <code>::</code> gets a property from the object's prototype:</p>
<pre><code>Array : 'prototype' : 'slice'   // function
Array :: 'slice'                // same function
</code></pre>
<hr>
<h4 id="conditional-get"><code>?:</code></h4>
<p>As <a href="#colon-getter"><code>:</code></a>, but <code>?:</code> short-circuits and returns <code>undefined</code> if the object is <code>null</code> or <code>undefined</code>:</p>
<pre><code>o = # u 5 v (# x 10 y 20)   // {u: 5, v: {x: 10, y: 20}}

o : 'q'          // undefined
o : 'q' : 'y'    // TypeError: Cannot read property 'y' of undefined
o : 'q' ?: 'y'   // undefined
</code></pre>
<hr>
<h4 id="at"><code>at</code></h4>
<p><code>at</code> can get multiple properties or characters — the second operand of <code>at</code> must be an iterable.</p>
<p><code>at</code> returns the same kind of object that it gets properties or characters from (string → string, array → array, object → object). Use a truthy third operand to force <code>at</code> to return an array:</p>
<pre><code>// array-of-objects
data = @
| (# Name 'vw pickup'     Horsepower 52 Origin 'Europe')
| (# Name 'dodge rampage' Horsepower 84 Origin 'USA')
| (# Name 'ford ranger'   Horsepower 79 Origin 'USA')

data at (@ 2 0)
    // [
    //   {Name: 'ford ranger', Horsepower: 79, Origin: 'USA'}
    //   {Name: 'vw pickup', Horsepower: 52, Origin: 'Europe'}
    // ]

data,2 at (@ 'Name' 'Origin')
    // {Name: 'ford ranger', Origin: 'USA'}

data,2 at (@ 'Name' 'Origin') 'array'
    // ['ford ranger', 'USA']

data,0,Origin at (@ 1 3)   // 'uo'
</code></pre>
<p>The second operand of <code>at</code> can be any iterable. For example, a string or a <a href="#ranges">range</a>:</p>
<pre><code># u 5 v 6 w 7 at 'uw'        // {u: 5, w 7}
'abcdefghij' at (1 to 9 2)   // 'bdfhj'
</code></pre>
<hr>
<h4 id="getter"><code>getter</code></h4>
<p>Use a custom getter function for a property:</p>
<pre><code>o = # celsius 10
o 'fahrenheit' getter [this,celsius * 1.8 + 32]

o,fahrenheit     // 50

o,celsius = 20   // 20 (set celsius property to 20)
o,fahrenheit     // 68
</code></pre>
<p>In general:</p>
<pre><code>o 'x' getter f
</code></pre>
<p>is equivalent to:</p>
<pre><code>Object ~defineProperty o 'x'
    #
    | get f
    | configurable true
    | enumerable true
</code></pre>
<p>See <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object,defineProperty</code></a> for details.</p>
<p><code>getter</code> returns the modified object.</p>
<h2 id="set-property">Set Property</h2>
<hr>
<h4>Assignment</h4>
<p>The assignment operator <code>=</code> and the update-assignment operators <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>, <code>^=</code> can be used to set an object/array property:</p>
<pre><code>circle = # radius 50 center (@ 100 200)

circle,color = 'red'   // 'red'
circle,radius = 60     // 60
circle,center,1 += 5   // 205

circle   // {radius: 60, center: [100, 205], color: 'red'}
</code></pre>
<hr>
<h4 id="chg"><code>chg</code></h4>
<p><code>chg</code> takes an object/array, a property name and a new value for the property. <code>chg</code> sets the property and returns the modified object:</p>
<pre><code>o = # u 5 v 6
o 
| chg 'u' 10
| chg 'w' 20   // {u: 10, v: 6, w: 20} 
</code></pre>
<blockquote>
<p>Setting a property with <code>chg</code> is equivalent to using assignment; it is not equivalent to using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object,defineProperty</code></a>.</p>
</blockquote>
<hr>
<h4 id="attach"><code>attach</code></h4>
<p><code>attach</code> sets properties using variables of the same name:</p>
<pre><code>width = 100
height = 200
color = 'red'

rect = # attach width      // {width: 100}
rect attach height color   // {width: 100, height: 200, color: 'red'}
</code></pre>
<hr>
<h4 id="copy-properties"><code>assign</code></h4>
<p>The <code>assign</code> operator copies properties from its second, third, fourth, ... operands to its first operand:</p>
<pre><code>o = # u 5 v 6
p = # v 7 w 8

# assign o     // {u: 5, v: 6} (shallow copy o)
# assign o p   // {u: 5, v: 7, w: 8}
o assign p     // {u: 5, v: 7, w: 8}
</code></pre>
<p><code>assign</code> is shorthand for calling <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign"><code>Object,assign</code></a>.</p>
<hr>
<h4 id="setter"><code>setter</code></h4>
<p>Use a custom setter function for a property:</p>
<pre><code>o = # celsius 10

o 'fahrenheit' getter [this,celsius * 1.8 + 32]
o 'fahrenheit' setter [this,celsius = a - 32 / 1.8]

o,fahrenheit   // 50

o,celsius = 20
o,fahrenheit   // 68

o,fahrenheit = 86
o,celsius      // 30
</code></pre>
<p>In general:</p>
<pre><code>o 'x' setter f
</code></pre>
<p>is equivalent to:</p>
<pre><code>Object ~defineProperty o 'x'
    #
    | set f
    | configurable true
    | enumerable true
</code></pre>
<p>See <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object,defineProperty</code></a> for details.</p>
<p><code>setter</code> returns the modified object.</p>
<h2 id="writing-functions">Writing Functions</h2>
<hr>
<p>A function can be a <strong>regular function</strong> or a <strong>procedure</strong>: a function that does not have its own <code>this</code>, <code>arguments</code> or <code>super</code> (i.e. a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">JavaScript arrow function</a>).</p>
<p>A function returns the value of the last expression evaluated.</p>
<hr>
<h4 id="fun"><code>fun</code>, <code>asyncFun</code></h4>
<p>Create a regular function.</p>
<p>The operands of <code>fun</code> are the parameter names and the function <a href="#body-operands">body</a>:</p>
<pre><code>// no parameters, body in parentheses
f = fun (5)
\f   // 5

// 2 parameters, body in parentheses
f = fun x y (x + y)
\f 5 10   // 15

// 2 parameters, body in indented block
f = fun x y
    z = x + y
    z + 30 / z
\f 5 10   // 3
</code></pre>
<p>Use <code>asyncFun</code> to create an asynchronous function. The following example uses <a href="#period"><code>period</code></a> to create a promise that resolves after <code>delay</code> milliseconds:</p>
<pre><code>af = asyncFun delay
    delay period await
    print 'done'

1000 \af   // waits 1000 ms, prints 'done'
</code></pre>
<hr>
<h4 id="proc"><code>proc</code>, <code>asyncProc</code></h4>
<p>As <a href="#fun"><code>fun</code></a> and <a href="#fun"><code>asyncFun</code></a>, but <code>proc</code> and <code>asyncProc</code> create a <a href="#writing-functions">procedure</a>.</p>
<hr>
<h4 id="bracket-functions">Bracket Functions</h4>
<p>Brackets can be used to create a (synchronous) function comprised of a single expression. Use square brackets for a <a href="#writing-functions">regular function</a> and curly brackets for a <a href="#writing-functions">procedure</a>. Bracket functions have parameters <code>a</code>, <code>b</code> and <code>c</code>:</p>
<pre><code>f = []        // regular function (body is empty)
\f            // undefined

f = [5]       // regular function
\f            // 5 

f = [a + 5]   // regular function
\f 10         // 15

f = {a + b}   // procedure
\f 10 5       // 15
</code></pre>
<blockquote>
<p>When bracket functions are nested, the inner function cannot see the parameters of the outer function because of the shared parameter names.</p>
</blockquote>
<hr>
<h4 id="rest">The <code>rest</code> Parameter</h4>
<p>If the final parameter of a function is called <code>rest</code>, it collects 'the rest of the arguments' in an array:</p>
<pre><code>f = fun x y rest
    rest
\f 5 6 7 8   // [7, 8]

f = fun rest
    rest
\f 5 6 7 8   // [5, 6, 7, 8]
</code></pre>
<hr>
<h4 id="default-parameters">Default Parameters</h4>
<p>Use <a href="#conditional-assignment"><code>?=</code></a> to set a default parameter value — the default is used if <code>undefined</code> or <code>null</code> is passed, or if no value is passed:</p>
<pre><code>f = fun x
    x ?= 5
    x + 10

\f 3   // 13
\f     // 15  
</code></pre>
<hr>
<h4 id="options">The <code>ops</code> Parameter</h4>
<p>A parameter called <code>ops</code> ('options') automatically defaults to an empty object. The assignment operator <code>&lt;-</code> is specifically for working with <code>ops</code> objects. <code>&lt;-</code> assigns a property of <code>ops</code> to a variable of the same name; the given default value is used if the property does not exist, or is <code>undefined</code> or <code>null</code>:</p>
<pre><code>area = fun ops
    width &lt;- 5
    height &lt;- 10
    width * height

# width 20 height 30 \area   // 600
# height 30 \area            // 150
\area                        // 50
</code></pre>
<p><code>ops</code> can be used with other parameters:</p>
<pre><code>f = fun x ops rest
    u &lt;- 5
    v &lt;- 6
    @ x u v rest

\f 10 (# u 20) 30 40   // [10, 20, 6, [30, 40]]   
</code></pre>
<blockquote>
<p>Except for defaulting to an empty object, there is nothing special about <code>ops</code> — it can be used and modified like any other object.</p>
</blockquote>
<blockquote>
<p><code>&lt;-</code> simply looks for the variable <code>ops</code> and gets the required property. <code>ops</code> will typically be a parameter of the current function, but need not be.</p>
</blockquote>
<blockquote>
<p><code>&lt;-</code> uses short-circuit evaluation: if the relevant property of <code>ops</code> is neither <code>null</code> nor <code>undefined</code>, the right-hand side of <code>&lt;-</code> is not evaluated.</p>
</blockquote>
<hr>
<h4 id="scope-op"><code>scope</code>, <code>asyncScope</code></h4>
<p>Using <code>scope</code> is equivalent to writing a <a href="#writing-functions">procedure</a> with no parameters and immediately calling it. Like all <a href="#body-operands">body</a> operands, variables created inside the body of <code>scope</code> are local:</p>
<pre><code>x = 5
y = scope
    x = 10
    x + 20
y   // 30
x   // 5
</code></pre>
<p><code>asyncScope</code> is the asynchronous version of <code>scope</code> — so <code>asyncScope</code> returns a promise rather than returning a value directly. <code>await</code> can be used in the body of <code>asyncScope</code>:</p>
<pre><code>// waits 1000 ms, prints 5
asyncScope
    period 1000 await
    print 5
</code></pre>
<hr>
<h4 id="as"><code>as</code>, <code>asyncAs</code></h4>
<p>Like <a href="#scope-op"><code>scope</code></a> and <a href="#scope-op"><code>asyncScope</code></a>, but the <a href="#body-operands">body</a> is preceded by an expression and a parameter that represents the value of the expression. The following example uses the <a href="#min"><code>max</code></a> operator:</p>
<pre><code>// array-of-objects
dogs = @
| (# name 'Alex' age 3) 
| (# name 'Beth' age 8) 
| (# name 'Cody' age 2)

// returns 'The oldest dog Beth is 8'
dogs max 'age' as oldest
    + 'The oldest dog 'oldest,name' is 'oldest,age
</code></pre>
<blockquote>
<p>The parameter of <code>as</code> can be <a href="#options"><code>ops</code></a>, but not <a href="#rest"><code>rest</code></a>.</p>
</blockquote>
<hr>
<h4 id="generator-functions">Generator Functions</h4>
<p>If <code>yield</code> or <code>yieldFrom</code> are used inside the body of <a href="#fun"><code>fun</code></a> (or <a href="#fun"><code>asyncFun</code></a>), a generator function (or asynchronous generator function) is created:</p>
<pre><code>f = fun
    yield 5
    yield 10   // generator function

g = \f         // generator
g ~next        // {value: 5, done: false}
</code></pre>
<p>A <a href="#writing-functions">procedure</a> cannot be a generator function:</p>
<pre><code>proc
    yield 5   // syntax error, invalid use of yield
</code></pre>
<p><code>yield</code> and <code>yieldFrom</code> <em>can</em> be used inside <a href="#scope-op"><code>scope</code></a>, <a href="#scope-op"><code>asyncScope</code></a>, <a href="#as"><code>as</code></a> and <a href="#as"><code>asyncAs</code></a>:</p>
<pre><code>g = scope
    yield 5
    yield 10   // generator

g ~next        // {value: 5, done: false}
</code></pre>
<blockquote>
<p>When <code>yield</code> or <code>yieldFrom</code> are used in <a href="#scope-op"><code>scope</code></a>, <a href="#scope-op"><code>asyncScope</code></a>, <a href="#as"><code>as</code></a> or <a href="#as"><code>asyncAs</code></a>, the operator will behave like a <a href="#writing-functions">regular function</a> rather than a <a href="#writing-functions">procedure</a> — in particular, the body will have its own <code>this</code>.</p>
</blockquote>
<h2 id="classes">Classes</h2>
<hr>
<h4 id="class"><code>class</code></h4>
<p>Create a class.</p>
<p>We can use a regular function as a constructor:</p>
<pre><code>Animal = fun name age
    this,name = name
    this,age = age

alex = new Animal 'Alex' 8   // Animal {name: &quot;Alex&quot;, age: 8}
</code></pre>
<p>The <code>class</code> operator is used like <a href="#fun"><code>fun</code></a>, but returns a class rather than a function. Furthermore, when <code>class</code> is used:</p>
<ul>
<li>If the constructor's <a href="#body-operands">body</a> is empty, the parameters are automatically added to <code>this</code>:</li>
</ul>
<pre><code class="indent">Animal = class name age ()

// is equivalent to:

Animal = class name age
    this,name = name
    this,age = age
</code></pre>
<ul>
<li>The constructor always returns the new instance:</li>
</ul>
<pre><code class="indent">Animal = fun (# u 5)     // function
new Animal               // {u: 5}

Animal = class (# u 5)   // class
new Animal               // Animal {}
</code></pre>
<ul>
<li>Calling the constructor throws an error:</li>
</ul>
<pre><code class="indent">Animal = class name ()

new Animal 'Alex'   // Animal {name: &quot;Alex&quot;}

\Animal 'Alex'      // TypeError: Class constructor Animal cannot
                    // be invoked without 'new'
</code></pre>
<p>Use <a href="#colon-proto-getter"><code>::</code></a> to add a function to an object's prototype — i.e. to add a method to a class:</p>
<pre><code>Animal = class name ()

Animal :: 'speak' = fun
    + this,name' makes a noise'

alex = new Animal 'Alex'
alex ~speak   // 'Alex makes a noise'
</code></pre>
<hr>
<h4 id="extends"><code>extends</code></h4>
<p>Create a subclass.</p>
<p><code>extends</code> is like <a href="#class"><code>class</code></a> except that:</p>
<ul>
<li>
<p>The first operand of <code>extends</code> is the parent class.</p>
</li>
<li>
<p>If the constructor <a href="#body-operands">body</a> is empty, the subclass is given a default constructor that passes its arguments to the parent constructor.</p>
</li>
</ul>
<pre><code>Animal = class name ()

Cat = extends Animal ()   // default constructor
Cat :: 'speak' = fun
    + this,name' meows'

Dog = extends Animal name breed
    \super name   // see below
    this,breed = breed
Dog :: 'speak' = fun
    + this,name' the 'this,breed' barks'

colin = new Cat 'Colin'
colin ~speak   // 'Colin meows'

debra = new Dog 'Debra' 'doberman'
debra ~speak   // 'Debra the doberman barks'  
</code></pre>
<p>In the <code>Dog</code> constructor above, we call <code>super</code> to call the constructor of the parent class. In fact, a subclass constructor <em>must</em> call <code>super</code> — and the call must be before <code>this</code> is used.</p>
<p>When using <code>extends</code>, the parent class need not have been created with <code>class</code>; it can be a regular function or a built-in object:</p>
<pre><code>Animal = fun ()             // function
Dog = extends Animal ()     // class
new Dog                     // Dog {}

Vector = extends Array ()   // class
new Vector 3                // Vector [empty × 3]
</code></pre>
<h2 id="loops">Loops</h2>
<hr>
<blockquote>
<p>Operators for working with iterables (including loop operators, but also see e.g. <a href="#reduce">Reduce</a>, <a href="#filter">Filter</a>, <a href="#group">Group</a>, <a href="#order">Order</a>, <a href="#bin">Bin</a>, <a href="#backticks">Backticks</a> and <a href="#nested-data">Nested Data</a>) treat empty array elements as normal elements (with value <code>undefined</code>). In contrast, some array methods ignore empty elements.</p>
</blockquote>
<hr>
<h4 id="each"><code>each</code></h4>
<p>Loop over an iterable.</p>
<p>The first operand of <code>each</code> is the iterable; the final operand is the loop <a href="#body-operands">body</a>. Between these, we can provide optional <em>loop parameters</em> for the current value, current index and the iterable:</p>
<pre><code>// body in parentheses, prints: 4 5 6
@ 4 5 6 each x (print x)

// body in indented block, prints: 'a0' 'b1' 'c2'
'abc' each s i
    s + i print
</code></pre>
<p><code>each</code> returns the iterable.</p>
<p>Use <code>stop</code> to exit a loop <em>at the end of the current step</em>:</p>
<pre><code>// prints 4 5 6
@ 4 5 6 7 8 each x
    print x
    if (x == 6)
        stop

// prints 4 5 6
@ 4 5 6 7 8 each x
    if (x == 6)
        stop
    print x
</code></pre>
<hr>
<h4 id="map"><code>map</code></h4>
<p>As <a href="#each"><code>each</code></a>, but <code>map</code> collects the value of the body (the last expression evaluated) at each step in an array:</p>
<pre><code>@ 4 5 6 map x (x + 10)   // [14, 15, 16]

// returns [14, 15, 16]
@ 4 5 6 7 8 map x i
    if (i == 2)
        stop
    x + 10
</code></pre>
<hr>
<h4 id="do"><code>do</code></h4>
<p>Basic loop.</p>
<p>The final operand of <code>do</code> is the loop <a href="#body-operands">body</a>. The optional operands are the maximum number of steps and the current index:</p>
<pre><code>// prints 0 1 2 3 4
5 do i
    print i
</code></pre>
<p><code>do</code> returns <code>undefined</code>.</p>
<p>Use <code>stop</code> to exit a loop <em>at the end of the current step</em>.</p>
<p>Use <code>Infinity</code> as the maximum number of steps when there is no actual maximum, but the index parameter is required:</p>
<pre><code>// prints 0 1 2 3 4
Infinity do i
    print i
    if (i == 4)
        stop
</code></pre>
<p>If only the loop body is given, the maximum number of steps defaults to <code>Infinity</code>:</p>
<pre><code>x = 1
do
    x *= 2
    if (x &gt; 20)
        stop
x   // 32
</code></pre>
<p>Even though <code>stop</code> only exits a loop at the end of the current step, we can use <code>if</code> with an <code>else</code> branch to effectively exit a loop at the point where <code>stop</code> is encountered:</p>
<pre><code>x = 25
do
    if (x &gt; 20)
        stop
    | else
        x *= 2
x   // 25
</code></pre>
<p>The maximum number of steps is fixed before the loop starts:</p>
<pre><code>// prints 0 1 2 3 4
n = 5
n do i
    n += 10
    print i
</code></pre>
<hr>
<h4 id="async-loops"><code>asyncEach</code>, <code>asyncMap</code>, <code>asyncDo</code></h4>
<p>Asynchronous versions of <a href="#each"><code>each</code></a>, <a href="#map"><code>map</code></a> and <a href="#do"><code>do</code></a>.</p>
<p>These operators return a promise that resolves to:</p>
<ul>
<li><code>asyncEach</code>: the iterable</li>
<li><code>asyncMap</code>: a new array</li>
<li><code>asyncDo</code>: <code>undefined</code></li>
</ul>
<p><code>await</code> can be used in the body of an asynchronous loop:</p>
<pre><code>// wait 1000 ms, print 5, wait 1000 ms, print 6 
@ 5 6 asyncEach x
    period 1000 await
    print x
</code></pre>
<p>In the following example, we <code>await</code> the loop itself:</p>
<pre><code>// wait 1000 ms, print 5, wait 1000 ms, print 6, print 'done'
asyncScope
    @ 5 6 asyncEach x
        period 1000 await
        print x
    | await
    print 'done'
</code></pre>
<hr>
<h4 id="loop-variables">Loop Parameters and Variables</h4>
<p>Loop parameters, and variables created inside the loop body are local to a single step of the loop. Assigning a new value to a parameter/variable will not affect its value at the next step, nor will it affect the behavior of the loop.</p>
<hr>
<h4 id="yield-in-loops">Using <code>yield</code> and <code>yieldFrom</code></h4>
<p>If <code>yield</code> or <code>yieldFrom</code> is used in the body of an <a href="#each"><code>each</code></a>, <a href="#do"><code>do</code></a>, <a href="#async-loops"><code>asyncEach</code></a> or <a href="#async-loops"><code>asyncDo</code></a> loop, the operator returns a generator (or asynchronous generator):</p>
<pre><code>g = 5 do i (yield i)   // generator
g array                // [0, 1, 2, 3, 4]

@ 5 6 7 each x
    yield x
    yieldFrom 'ab'
| array                // [5, 'a', 'b', 6, 'a', 'b', 7, 'a', 'b']
</code></pre>
<blockquote>
<p><code>yield</code> and <code>yieldFrom</code> turn a loop into a generator function (which is automatically called to give the returned generator) so the loop will have its own <code>this</code>, <code>arguments</code> and <code>super</code>.</p>
</blockquote>
<h2 id="exceptions">Exceptions</h2>
<hr>
<h4 id="throw"><code>throw</code></h4>
<p>Use the <code>throw</code> operator to throw an exception:</p>
<pre><code>\Error 'something went wrong' throw
</code></pre>
<p>The exception need not be an <code>Error</code> object, it can be anything:</p>
<pre><code>@ 5 6 7 throw
</code></pre>
<hr>
<h4 id="try"><code>try</code>, <code>asyncTry</code></h4>
<p>The single operand of <code>try</code> is the <a href="#body-operands">body</a>. The code in the body is executed; if it throws, <code>try</code> immediately returns whatever was thrown:</p>
<pre><code>// prints 1, returns the Error object (2 is not printed)
try
    print 1
    \Error 'something went wrong' throw
    print 2
</code></pre>
<p>If the body of <code>try</code> does not throw, <code>try</code> returns <code>undefined</code>.</p>
<p><code>asyncTry</code> is the asynchronous version of <code>try</code>. <code>asyncTry</code> returns a promise that resolves to whatever was thrown, or <code>undefined</code> if nothing was thrown. <code>await</code> can be used in the body of <code>asyncTry</code> — see <a href="#catch"><code>catch</code></a> for an example.</p>
<hr>
<h4 id="catch"><code>catch</code>, <code>asyncCatch</code></h4>
<p><code>catch</code> takes three operands:</p>
<ul>
<li>an expression: typically an application of <a href="#try"><code>try</code></a></li>
<li>a parameter: takes the value of the expression (the parameter is local to the body)</li>
<li>a <a href="#body-operands">body</a></li>
</ul>
<p>The body is only executed if the <code>try</code> expression is truthy:</p>
<pre><code>// prints 'something went wrong'
try
    \Error 'something went wrong' throw
| catch err
    err,message print
</code></pre>
<p><code>catch</code> returns <code>undefined</code>.</p>
<p>Here is an example of using <code>catch</code> with <a href="#try"><code>asyncTry</code></a>:</p>
<pre><code>// waits 1000 ms, prints 'something went wrong'
asyncScope
    asyncTry
        period 1000 await
        \Error 'something went wrong' throw
    | await catch err
        err,message print
</code></pre>
<p><code>asyncCatch</code> is the asynchronous version of <code>catch</code>. <code>asyncCatch</code> returns a promise that resolves to <code>undefined</code>. <code>await</code> can be used in the body of <code>asyncCatch</code>.</p>
<h2 id="is">Is</h2>
<hr>
<p>These operators return a boolean:</p>
<table class="table table-sm w500">
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isArray</code></td>
<td>is array?</td>
</tr>
<tr>
<td><code>isBigInt</code></td>
<td>is bigint?</td>
</tr>
<tr>
<td><code>isBoolean</code></td>
<td>is boolean?</td>
</tr>
<tr>
<td><code>isFinite</code></td>
<td>is finite? (always <code>false</code> for non-number)</td>
</tr>
<tr>
<td><code>isFunction</code></td>
<td>is function?</td>
</tr>
<tr>
<td><code>isInteger</code></td>
<td>is integer? (always <code>false</code> for non-number)</td>
</tr>
<tr>
<td><code>isNaN</code></td>
<td>is <code>NaN</code>? (always <code>false</code> for non-number)</td>
</tr>
<tr>
<td><code>isNull</code></td>
<td>is <code>null</code>?</td>
</tr>
<tr>
<td><code>isNullish</code></td>
<td>is <code>null</code> or <code>undefined</code>?</td>
</tr>
<tr>
<td><code>isNumber</code></td>
<td>is number?</td>
</tr>
<tr>
<td><code>isString</code></td>
<td>is string?</td>
</tr>
<tr>
<td><code>isSymbol</code></td>
<td>is symbol?</td>
</tr>
<tr>
<td><code>isUndefined</code></td>
<td>is <code>undefined</code>?</td>
</tr>
</tbody>
</table>
<pre><code>5 isNumber        // true
5 isInteger       // true

'5' isNumber      // false
'5' isInteger     // false

null isNullish    // true
false isNullish   // false
</code></pre>
<h2 id="elementwise">Elementwise</h2>
<hr>
<p>Elementwise operators take a single operand. If the operand is a non-string iterable, the operator acts on each element independently and returns the results as an array. Otherwise, the operator acts on the operand directly and returns the result:</p>
<pre><code>4 sqrt        // 2
@ 9 16 sqrt   // [3, 4]

'ab' toUpperCase          // 'AB'
@ 'cd' 'ef' toUpperCase   // ['CD', 'EF']
</code></pre>
<hr>
<h4 id="ew-math">Elementwise Math</h4>
<p>Elementwise math operators use the corresponding methods of the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math"><code>Math</code></a> object. The elementwise math operators are:</p>
<p><code>abs</code> <code>acos</code> <code>acosh</code> <code>asin</code> <code>asinh</code> <code>atan</code> <code>atanh</code> <code>cbrt</code> <code>ceil</code> <code>clz32</code> <code>cos</code> <code>cosh</code> <code>exp</code> <code>expm1</code> <code>floor</code> <code>fround</code> <code>log</code> <code>log10</code> <code>log1p</code> <code>log2</code> <code>round</code> <code>sign</code> <code>sin</code> <code>sinh</code> <code>sqrt</code> <code>tan</code> <code>tanh</code> <code>trunc</code></p>
<hr>
<h4 id="ew-other">Elementwise Other</h4>
<table class="table table-sm w500">
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>boolean</code></td>
<td>convert to boolean</td>
</tr>
<tr>
<td><code>date</code></td>
<td>convert to date</td>
</tr>
<tr>
<td><code>neg</code></td>
<td>unary minus</td>
</tr>
<tr>
<td><code>not</code></td>
<td>logical not</td>
</tr>
<tr>
<td><code>number</code></td>
<td>convert to number</td>
</tr>
<tr>
<td><code>string</code></td>
<td>convert to string</td>
</tr>
<tr>
<td><code>toLowerCase</code></td>
<td>convert to lowercase string</td>
</tr>
<tr>
<td><code>toUpperCase</code></td>
<td>convert to uppercase string</td>
</tr>
<tr>
<td><code>trim</code></td>
<td>remove whitespace from both ends of string</td>
</tr>
<tr>
<td><code>trimEnd</code></td>
<td>remove whitespace from end of string</td>
</tr>
<tr>
<td><code>trimStart</code></td>
<td>remove whitespace from start of string</td>
</tr>
</tbody>
</table>
<blockquote>
<p><code>toLowerCase</code>, <code>toUpperCase</code>, <code>trim</code>, <code>trimEnd</code> and <code>trimStart</code> convert values to strings.</p>
</blockquote>
<h2 id="conditional">Conditional</h2>
<hr>
<h4 id="ternary"><code>?</code></h4>
<p>The <code>?</code> operator evaluates a <em>test</em>; if the test is truthy, the second operand is evaluated and returned, otherwise the third operand is evaluated and returned. If the third operand is omitted and the test is falsy, no code is evaluated (except for the test) and <code>?</code> returns <code>undefined</code>.</p>
<pre><code>true ? 5 10    // 5
false ? 5 10   // 10
4 &gt; 5 ? 6      // undefined
4 &lt; 5 ? 6      // 6

// returns 8
3 == 4 ?
    5
    6
|
    7
    8
</code></pre>
<hr>
<h4 id="if"><code>if</code></h4>
<p>The <code>if</code> operator has operands <em>test</em>, <em>action</em>, <em>test</em>, <em>action</em>, ... The tests are evaluated in sequence; when a test returns truthy, the corresponding action is evaluated and <code>if</code> returns the result. If no test is truthy, no action is evaluated and <code>if</code> returns <code>undefined</code>.</p>
<p>Often, we want the final test of an <code>if</code> to be truthy to ensure that some action is taken. In this case, we use the special constant <code>else</code> as the final test. This is equivalent to using <code>true</code>, but the code is easier to read:</p>
<pre><code>exam = 60

if (exam &gt;= 50) 'Pass'          // 'Pass'
if (exam &gt;= 80) 'Distinction'   // undefined

// prints 'You got a Pass'
'You got a ' +
    if
    | (exam &gt;= 80) 'Distinction'
    | (exam &gt;= 50) 'Pass'
    | else         'Fail'

// prints 'Good', returns 'Pass'
if (exam &gt;= 80)
    'Great' print
    'Distinction'
| (exam &gt;= 50)
    'Good' print
    'Pass'
| else
    'Try again' print
    'Fail'
</code></pre>
<blockquote>
<p><code>else</code> is equivalent to a literal <code>true</code>. For example, <code>else == true</code> is <code>true</code>, and <code>else string</code> is <code>'true'</code>.</p>
</blockquote>
<h2 id="ranges">Ranges</h2>
<hr>
<h4 id="to"><code>to</code></h4>
<p><code>to</code> returns a generator that represents a sequence of equally spaced numbers. <code>to</code> takes three operands: <em>start</em>, <em>end</em> and <em>step</em>. <em>step</em> is 1 by default:</p>
<pre><code>5 to 7           // generator (5 6 7)
1.5 to 10 3      // generator (1.5 4.5 7.5)
1 to (-2) (-1)   // generator (1 0 -1 -2)

r = 5 to 7   // generator (5 6 7)
r ~next      // {value: 5, done: false}
r ~next      // {value: 6, done: false}
r ~next      // {value: 7, done: false}
r ~next      // {value: undefined, done: true}
</code></pre>
<p>Generators are iterables, so can be used with many operators — see e.g. <a href="#loops">Loops</a>, <a href="#reduce">Reduce</a>, <a href="#filter">Filter</a>, <a href="#group">Group</a>, <a href="#order">Order</a>, <a href="#bin">Bin</a>, <a href="#backticks">Backticks</a> and <a href="#destructure-iterable">Destructuring</a>. Some examples:</p>
<pre><code>5 to 7 each a (print a)   // prints 5 6 7
5 to 7 array              // [5, 6, 7]
5 to 7 mean               // 6
5 to 7 `+ 10              // [15, 16, 17]
u v w @= 5 to 7           // u is 5, v is 6, w is 7
'abcdefg' at (0 to 6 2)   // 'aceg'
</code></pre>
<hr>
<h4 id="lin-space"><code>linSpace</code></h4>
<p>As <a href="#to"><code>to</code></a>, but the third operand of <code>linSpace</code> (which should be a non-negative integer) is the number of steps:</p>
<pre><code>2 8 linSpace 4      // generator (2 4 6 8)
3 6 linSpace 3      // generator (3 4.5 6)
2 (-7) linSpace 4   // generator (2 -1 -4 -7) 
</code></pre>
<blockquote>
<p>Due to floating-point arithmetic, the final element of a range created with <code>linSpace</code> may not be identical to the <em>end</em> operand.</p>
</blockquote>
<h2 id="backticks">Backticks</h2>
<hr>
<p>A backtick before an operator indicates that the first operand is an iterable. A backtick after an operator indicates that the second operand is an iterable:</p>
<pre><code>x = @ 5 6 7
x `+ 10              // [15, 16, 17]       
10 +` x              // [15, 16, 17]
x map xi (xi + 10)   // [15, 16, 17] (without backtick)

y = @ 10 20 30
x `+` y                 // [15, 26, 37]  
x map xi i (xi + y;i)   // [15, 26, 37] (without backticks)
</code></pre>
<p>Backticks can be used with the following operators: <code>+</code> <code>-</code> <code>*</code> <code>/</code> <code>%</code> <code>^</code> <code>&amp;&amp;</code> <code>||</code> <code>??</code> <code>&lt;&gt;</code> <code>&gt;&lt;</code> <code>&lt;</code> <code>&lt;=</code> <code>&gt;</code> <code>&gt;=</code> <code>==</code> <code>!=</code>.</p>
<blockquote>
<p>If an operator has any backticks, it must have exactly two operands — <code>x + y z</code> is valid code, but <code>x `+` y z</code> is not.</p>
</blockquote>
<blockquote>
<p>If any backticks are used with <code>&amp;&amp;</code>, <code>||</code> or <code>??</code>, short-circuit evaluation is <em>not</em> used — both operands are always evaluated.</p>
</blockquote>
<p>Backticks can be used with any iterables; the result is always an array:</p>
<pre><code>r = 5 to 7     // generator (5 6 7)
s = @@ 4 6 8   // Set {4, 6, 8}
r `==` s       // [false, true, false]
</code></pre>
<p>When both operands are iterables, the returned array is the length of the shortest iterable:</p>
<pre><code>@ 5 6 7 `+` (@ 10 20)   // [15, 26]
</code></pre>
<p>A backtick really means &quot;treat this operand as an iterable&quot;. For example, a string is an iterable, but we may want to treat it as a single value:</p>
<pre><code>'ab'  +  'X'    // 'abX'
'ab' `+  'X'    // ['aX', 'bX']
'ab'  +` 'X'    // ['abX']
'ab' `+` 'X'    // ['aX']

'ab'  +  'XY'   // 'abXY'
'ab' `+  'XY'   // ['aXY', 'bXY']
'ab'  +` 'XY'   // ['abX', 'abY']
'ab' `+` 'XY'   // ['aX', 'bY']
</code></pre>
<h2 id="reduce">Reduce</h2>
<hr>
<p>Unless otherwise stated, reduction operators take an iterable and a callback function (default <code>[a]</code>). The callback is applied to each element of the iterable (the callback is passed the element, index and iterable) and the returned values are used to compute the result:</p>
<pre><code>x = @ 4 5 6
x sum            // 15
x sum [a &gt;&lt; 5]   // 16 (&gt;&lt; is 'greatest')
</code></pre>
<p>When 'reducing' an iterable of objects/arrays, an inner property/index can be used instead of a callback function:</p>
<pre><code>x = @ 
| (# u 5 v 10)
| (# u 6 v 20)
| (# u 5 v 30)   // array-of-objects

x sum [a,v]   // 60
x sum 'v'     // 60
</code></pre>
<hr>
<h4><code id="count">count</code></h4>
<p>Count the truthy values:</p>
<pre><code>s = @@ 1 '1' true 0    // Set {1, &quot;1&quot;, true, 0}
s count                // 3
s count [a isNumber]   // 2
</code></pre>
<hr>
<h4><code>every</code>, <code id="every">some</code></h4>
<p><code>every</code> returns <code>true</code> if all values are truthy; <code>some</code> returns <code>true</code> if any value is truthy:</p>
<pre><code>x = @ 5 null 'abc'
x every            // false
x some             // true
x some [a == 10]   // false

m = ##
| apple 'green'
| banana 'yellow'
| cherry 'red'   // Map {'apple' =&gt; 'green', ...}

// use values method of map
m ~values every [a == 'green']   // false 
m ~values some  [a == 'green']   // true
</code></pre>
<p>If the iterable is empty, <code>every</code> returns <code>true</code>, <code>some</code> returns <code>false</code>.</p>
<hr>
<h4><code>find</code>, <code id="find">findIndex</code></h4>
<p><code>find</code> returns the element corresponding to the first truthy value. <code>findIndex</code> is like <code>find</code>, but returns the index of the element:</p>
<pre><code>x = @ 3 7 2 9
x find [a &gt; 5]        // 7
x findIndex [a &gt; 5]   // 1

x = @
| (# u 5)
| (# u 6 v 10)
| (# u 7 v 30)   // array-of-objects

x find 'v'              // {u: 6, v: 10}
x find [a,u == 7]       // {u: 7, v: 30}
x findIndex [a,u &gt; 5]   // 1
</code></pre>
<p>If there are no truthy values, <code>find</code> returns <code>undefined</code>, <code>findIndex</code> returns <code>-1</code>.</p>
<hr>
<h4><code>min</code>, <code>max</code>, <code>minIndex</code>, <code id="min">maxIndex</code></h4>
<p><code>min</code>/<code>max</code> returns the element corresponding to the minimum/maximum value:</p>
<pre><code>@ 7 3 2 5 min   // 2

x = @ (@ 2 10) (@ 7 20) (@ 5 30)   // array-of-arrays
x max 0                            // [7, 20]
</code></pre>
<p>If multiple elements correspond to the minimum/maximum value, the first such element is returned.</p>
<p><code>minIndex</code> and <code>maxIndex</code> are like <code>min</code> and <code>max</code> respectively, but return the index corresponding to the minimum/maximum value:</p>
<pre><code>@ 3 9 5 maxIndex   // 1
</code></pre>
<p>Values are treated as numbers. If any value converts to <code>NaN</code> or if the iterable is empty, <code>min</code> and <code>max</code> return <code>undefined</code>, <code>minIndex</code> and <code>maxIndex</code> return <code>-1</code>.</p>
<hr>
<h4><code>sum</code>, <code>mean</code>, <code>variance</code>, <code>variancePop</code>, <code>deviation</code>, <code id="sum">deviationPop</code></h4>
<p>Sum, mean, variance and standard deviation:</p>
<pre><code>x = @ 4 6 8
x sum         // 18
x mean        // 6
x variance    // 4
x deviation   // 2

x = @
| (# u 5 v 10)
| (# u 6 v 20)
| (# u 7 v 30)   // array-of-objects
x sum 'v'        // 60
</code></pre>
<p><code>variance</code> and <code>deviation</code> compute the sample variance and sample standard deviation. Use <code>variancePop</code> and <code>deviationPop</code> for the population variance and population standard deviation.</p>
<p>Values are treated as numbers. If any value converts to <code>NaN</code>, these operators return <code>NaN</code>.</p>
<p><code>sum</code> returns <code>0</code> if the iterable is empty, <code>mean</code> returns <code>NaN</code>. The variance and standard deviation operators return <code>NaN</code> if the iterable has less than 2 elements.</p>
<hr>
<h4><code id="sum-cumu">sumCumu</code></h4>
<p><code>sumCumu</code> is like <a href="#sum"><code>sum</code></a>, but returns an array of cumulative sums rather than just the result:</p>
<pre><code>x = @ 3 8 2 10
x sum       // 23
x sumCumu   // [3, 11, 13, 23]

x = @
| (# u 5 v 10)
| (# u 6 v 20)
| (# u 7 v 30)     // array-of-objects
x sumCumu 'v'      // [10, 30, 60]
</code></pre>
<blockquote>
<p><code>sumCumu</code> is <em>not</em> a reduction operator, but is listed here due to its similarity to <code>sum</code>.</p>
</blockquote>
<hr>
<h4><code>correlation</code>, <code>covariance</code>, <code id="correlation">covariancePop</code></h4>
<p>Correlation and covariance. These operators take two callbacks (both are passed the element, index and iterable). As with other reduction operators, an inner property/index can be used instead of a callback:</p>
<pre><code>x = @
| (# u 5 v 8)
| (# u 6 v 9)
| (# u 7 v 12)   // array-of-objects

x correlation [a,u] [a,v]   // 0.96
x correlation 'u' 'v'       // 0.96
</code></pre>
<p>If the data is in two separate iterables, refer to the second iterable explicitly in the second callback and use the index to get the element:</p>
<pre><code>u = @ 5 6 7
v = @ 8 9 12

u correlation [a] [v;b]   // 0.96
</code></pre>
<p><code>correlation</code> computes the Pearson correlation coefficient. To compute Spearman's rank correlation coefficient, use <a href="#order"><code>rank</code></a> then <code>correlation</code>:</p>
<pre><code>u = @ 3 4 5
v = @ 3 9 5
ru = rank u   // [0, 1, 2]
rv = rank v   // [0, 2, 1]

u correlation [a] [v;b]     // 0.33
ru correlation [a] [rv;b]   // 0.5
</code></pre>
<p><code>covariance</code> computes the sample covariance. Use <code>covariancePop</code> for the population covariance.</p>
<p>Values are treated as numbers. If any value converts to <code>NaN</code> or if the iterable has less than 2 elements, these operators return <code>NaN</code>.</p>
<hr>
<h4><code>median</code>, <code id="median">quantile</code></h4>
<p><code>median</code> returns the median:</p>
<pre><code>@ 4 2 7 median      // 4
@ 4 2 7 10 median   // 5.5

y = @ 
| (# u 5 v 25)
| (# u 6 v 10)
| (# u 7 v 30)    // array-of-objects
y median 'v'      // 25
</code></pre>
<p>If the values are already sorted, use a third truthy operand with <code>median</code> to skip the sorting step.</p>
<p><code>quantile</code> is like <code>median</code>, but takes an extra operand — a probability bounded at 0 and 1 — after the iterable:</p>
<pre><code>x = @ 4 2 7 10 
x quantile 0         // 2
x quantile 1         // 10
x quantile 0.5       // 5.5 (the median)
x quantile (2 / 3)   // 7

y = @ 
| (# u 5 v 25)
| (# u 6 v 10)
| (# u 7 v 30)        // array-of-objects
y quantile 0.25 'v'   // 17.5
</code></pre>
<p><code>median</code> and <code>quantile</code> use linear interpolation. Values (and the probability operand of <code>quantile</code>) are treated as numbers. If any of the numbers are <code>NaN</code> or if the iterable is empty, <code>median</code> and <code>quantile</code> return <code>NaN</code>.</p>
<hr>
<h4 id="reduce-op"><code>reduce</code></h4>
<p>The <code>reduce</code> operator takes an iterable, a 'reducer function' and an initial result. The reducer function is called once for each element of the iterable; it is passed the 'current result', the element, the index and the iterable:</p>
<pre><code>@ 5 6 7 reduce [a + b] 0   // 18
</code></pre>
<blockquote>
<p>The initial result is required — in contrast to the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce"><code>reduce</code> array method</a> where the initial result is optional.</p>
</blockquote>
<h2 id="filter">Filter</h2>
<hr>
<p><code>filter</code> takes an iterable and a callback function (default <code>[a]</code>). The callback is applied to each element of the iterable (it is passed the element, index and iterable); if the result is truthy, the element is included in the array returned by <code>filter</code>:</p>
<pre><code>@ true false null 5 filter   // [true, 5]
@ 3 7 4 9 filter [a &gt; 5]     // [7, 9]

x = @
| (# u 5 v 10)
| (# u 6 v 20)
| (# u 5 v 30)   // array-of-objects

x filter [a,u == 5]   // [{u: 5, v: 10}, {u: 5, v: 30}]

// filterIndex
x filterIndex [a,u == 5]   // [0, 2]
</code></pre>
<p>As shown in the final example, <code>filterIndex</code> can be used to get the original indices of the filtered elements.</p>
<p>When filtering an iterable of objects/arrays, an inner property/index can be used instead of a callback function:</p>
<pre><code>x = @ 
| (# u 5 v 10)
| (# u 6)
| (# u 5 v 30)   // array-of-objects

x filter [a,v]   // [{u: 5, v: 10}, {u: 5, v: 30}]
x filter 'v'     // [{u: 5, v: 10}, {u: 5, v: 30}]
</code></pre>
<h2 id="group">Group</h2>
<hr>
<p><code>group</code> takes an iterable and a callback function (default <code>[a]</code>). The callback is applied to each element of the iterable (it is passed the element, index and iterable); the results are used to group the elements. When grouping an iterable of objects/arrays, an inner property/index can be used instead of a callback function — for example, <code>'v'</code> can be used instead of the callback <code>[a,v]</code>.</p>
<p><code>group</code> returns a map with arrays for values:</p>
<pre><code>x = @ 
| (# u 5 v 10)
| (# u 6 v 20)
| (# u 5 v 30)   // array-of-objects
  
x group 'u'   // Map {
              //   5 =&gt; [{u: 5, v: 10}, {u: 5, v: 30}]
              //   6 =&gt; [{u: 6, v: 20}]
              // }

// second callback
x group 'u' [a mean 'v']   // Map {5 =&gt; 20, 6 =&gt; 20}
</code></pre>
<p>As shown in the example, <code>group</code> can take a second callback. This is applied to each group (it is passed a value and key of the map at each step, as well as the index) and the results are used as the values of the returned map.</p>
<p><code>groupCount</code> gets the size of each group:</p>
<pre><code>@ 5 2 5 5 7 2 groupCount   // Map {5 =&gt; 3, 2 =&gt; 2, 7 =&gt; 1}

x = @ 
| (# u 5 v 10)
| (# u 6 v 20)
| (# u 5 v 30)   // array-of-objects

x groupCount 'u'           // Map {5 =&gt; 2, 6 =&gt; 1}
x groupCount 'u' [a &gt; 1]   // Map {5 =&gt; true, 6 =&gt; false}
</code></pre>
<h2 id="order">Order</h2>
<hr>
<p><code>order</code> takes an iterable and a 'comparison function' (see the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort"><code>sort</code> array method</a>), and returns a new array containing the sorted elements of the iterable. The default comparison function is <code>[a - b]</code> which sorts (finite) numbers or dates in ascending order.</p>
<p><code>orderIndex</code> and <code>rank</code> behave like <code>order</code> except that:</p>
<ul>
<li>
<p><code>orderIndex</code> returns the original indices of the sorted elements.</p>
</li>
<li>
<p><code>rank</code> returns the rank of each element.</p>
</li>
</ul>
<pre><code>x = @ 5 9 2
x order        // [2, 5, 9]
x orderIndex   // [2, 0, 1] 
x rank         // [1, 2, 0]

y = @ 
| (# u 5 v 20)
| (# u 6 v 10)
| (# u 7 v 30)   // array-of-objects

// sort on property v, descending
f = [b,v - a,v]
y order f        // [{u: 7, v: 30}, {u: 5, v: 20}, {u: 6, v: 10}]
y orderIndex f   // [2, 0, 1]
y rank f         // [1, 2, 0]

// tied values
@ 2 3 4 3 rank   // [0, 1, 3, 1]
</code></pre>
<p>For convenience, the comparison function can be replaced with <code>'asc'</code> (ascending) or <code>'desc'</code> (descending):</p>
<pre><code>x = @ 5 9 2
x order 'desc'        // [9, 5, 2]
x orderIndex 'desc'   // [1, 0, 2] 
x rank 'desc'         // [1, 0, 2]
</code></pre>
<p>To order an iterable of objects/arrays on an inner property/index, an additional operand can be used after <code>'asc'</code> or <code>'desc'</code> that specifies the property/index:</p>
<pre><code>y = @ 
| (# u 5 v 20)
| (# u 6 v 10)
| (# u 7 v 30)   // array-of-objects

// sort on property v, descending
y order 'desc' 'v'        // [{u: 7, v: 30}, {u: 5, v: 20}, {u: 6, v: 10}]
y orderIndex 'desc' 'v'   // [2, 0, 1]
y rank 'desc' 'v'         // [1, 2, 0]
</code></pre>
<blockquote>
<p><code>'asc'</code> or <code>'desc'</code> should only be used to sort (finite) numbers or dates.</p>
</blockquote>
<h2 id="bin">Bin</h2>
<hr>
<p><code>bin</code> takes an iterable to bin, an iterable of bin limits and a 'comparison function' (see <a href="#order"><code>order</code></a> and the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort"><code>sort</code> array method</a>). The default comparison function is <code>[a - b]</code> which is suitable for binning (finite) numbers or dates. <code>bin</code> returns a map with arrays for values:</p>
<pre><code>@ 5 9 12 7 bin (@ 10 20)   // Map {10 =&gt; [5, 9, 7], 20 =&gt; [12]}

x = @ 
| (@ 23 0) (@ 7 1) (@ 32 2) 
| (@ 38 3) (@ 3 4) (@ 34 5)   // array-of-arrays

limits = @ 10 20 30 40

x bin limits [a,0 - b]   // Map {
                         //   10 =&gt; [[7, 1], [3, 4]],
                         //   20 =&gt; [],
                         //   30 =&gt; [[23, 0]],
                         //   40 =&gt; [[32, 2], [38, 3], [34, 5]]
                         // }

// second callback
x bin limits [a,0 - b] [a pick 1]   // Map {
                                    //   10 =&gt; [1, 4]
                                    //   20 =&gt; []
                                    //   30 =&gt; [0]
                                    //   40 =&gt; [2, 3, 5]
                                    // }

// binCount
@ 5 9 12 7 binCount (@ 10 20)   // Map {10 =&gt; 3, 20 =&gt; 1}
x binCount limits [a,0 - b]     // Map {10 =&gt; 2, 20 =&gt; 0, 30 =&gt; 1, 40 =&gt; 3}
x binCount limits [a,0 - b] [a &gt; 1]   // Map {
                                      //   10 =&gt; true,
                                      //   20 =&gt; false,
                                      //   30 =&gt; false,
                                      //   40 =&gt; true
                                      // }
</code></pre>
<p>As shown in the example, <code>bin</code> can take a second callback (the example uses <a href="#pick">pick</a>). This is applied to each bin (it is passed a value and key of the map at each step, as well as the index) and the results are used as the values of the returned map.</p>
<p><code>binCount</code> gets the number of elements in each bin — see the final examples above. While we could use <code>bin</code> with a second callback for this, <code>binCount</code> is more efficient and is easier to read.</p>
<p>An element is assigned to a bin if the comparison function (which is passed the element and the bin limit) is less than or equal to 0. Using the default comparison function <code>[a - b]</code> is equivalent to specifying inclusive upper bin limits — use <code>[b - a]</code> to specify lower bin limits. Elements that are not assigned to any bin do not appear in the map returned by <code>bin</code> (or contribute to any value in <code>binCount</code>).</p>
<blockquote>
<p><code>bin</code> and <code>binCount</code> assume that the bin limits are already sorted (with respect to the comparison function). If this is not the case, <code>bin</code> and <code>binCount</code> will give unexpected results.</p>
</blockquote>
<blockquote>
<p>The elements inside each bin are <em>not</em> sorted — they appear in the same order as in the original iterable.</p>
</blockquote>
<h2 id="joins">Joins</h2>
<hr>
<p id="inner-join"><code>innerJoin</code>, <code>leftJoin</code>, <code>rightJoin</code>, <code>outerJoin</code></p>
<p>Database-style joins. The first two operands are iterables; the elements of each iterable should be objects or arrays. The third operand specifies the join criteria which can be a:</p>
<ul>
<li>
<p>function: called on each pair of elements of the iterables; if the function returns a truthy value, the pair of elements is included in the join.</p>
</li>
<li>
<p>non-string iterable: the inner property names/indices to join on — the first element corresponds to the first iterable, the second element to the second iterable.</p>
</li>
<li>
<p>string/number: the inner property name/index to join on — use this when the name/index is the same for both iterables.</p>
</li>
</ul>
<p>The optional fourth operand is the maximum number of results to yield.</p>
<p>Join operators return a generator that yields arrays; each array contains a pair of elements from the iterables. The operators differ on how they treat unmatched elements:</p>
<ul>
<li>
<p><code>innerJoin</code>: unmatched elements are not included.</p>
</li>
<li>
<p><code>leftJoin</code>: unmatched elements of the first iterable are included.</p>
</li>
<li>
<p><code>rightJoin</code>: unmatched elements of the second iterable are included.</p>
</li>
<li>
<p><code>outerJoin</code>: unmatched elements of both iterables are included.</p>
</li>
</ul>
<pre><code>p = @ 
| (# u 1 v 4)
| (# u 2 v 5)
| (# u 3 v 6)        // array-of-objects

q = @
| (# u 0 w 7 x 10)
| (# u 3 w 8 x 20)
| (# u 1 w 9 x 30)   // array-of-objects

r = @
| (# x 10 y 11)
| (# x 30 y 31)      // array-of-objects

// these are equivalent
p outerJoin q [a,u == b,u]   // generator
p outerJoin q (@ 'u' 'u')    // generator
p outerJoin q 'u'            // generator

p outerJoin q 'u' array
  // [
  //   [{u: 1, v: 4}, {u: 1, w: 9, x: 30}],
  //   [{u: 3, v: 6}, {u: 3, w: 8, x: 20}],
  //   [{u: 2, v: 5}, null               ],
  //   [null,         {u: 0, w: 7, x: 10}]
  // ]

// chained join - this is easier with crush (see below)
p outerJoin q 'u' outerJoin r [a,1 ?: 'x' == b,x] array
  // [
  //   [{u: 1, v: 4}, {u: 1, w: 9, x: 30}, {x: 30, y: 31}], 
  //   [null,         {u: 0, w: 7, x: 10}, {x: 10, y: 11}], 
  //   [{u: 3, v: 6}, {u: 3, w: 8, x: 20}, null          ], 
  //   [{u: 2, v: 5}, null,                null          ]
  // ]
</code></pre>
<p>Unless speed or memory usage is critical, we typically <a href="#crush"><code>crush</code></a> the generator returned by a join operator — the resulting array-of-objects is easier to work with.</p>
<blockquote>
<p>In the &quot;chained join&quot; example above, the depth of nesting does not increase — elements have the form <code>[{...}, {...}, {...}]</code>, not <code>[[{...}, {...}], {...}]</code>. When chaining joins, the intermediate join must be the returned generator or crushed to get this behavior.</p>
</blockquote>
<hr>
<h4 id="crush"><code>crush</code></h4>
<p>Flatten a join into an array-of-objects. The first operand is the join; additional operands are objects that specify which properties to keep and property name prefixes:</p>
<pre><code>p = @ 
| (# u 1 v 4)
| (# u 2 v 5)
| (# u 3 v 6)        // array-of-objects

q = @
| (# u 0 w 7 x 10)
| (# u 3 w 8 x 20)
| (# u 1 w 9 x 30)   // array-of-objects

r = @
| (# x 10 y 11)
| (# x 30 y 31)      // array-of-objects

p outerJoin q 'u' crush
  // [
  //   {u: 1, v: 4, w: 9, x: 30},
  //   {u: 3, v: 6, w: 8, x: 20},
  //   {u: 2, v: 5             },
  //   {u: 0,       w: 7, x: 10}
  // ]                 

p outerJoin q 'u'
| crush (# prefix 'p_') (# prefix 'q_' keep (@ 'u' 'x'))
  // [
  //   {p_u: 1, p_v: 4, q_u: 1, q_x: 30},
  //   {p_u: 3, p_v: 6, q_u: 3, q_x: 20},
  //   {p_u: 2, p_v: 5                 },
  //   {                q_u: 0, q_x: 10}
  // ]

// chained join
p outerJoin q 'u' crush outerJoin r 'x' crush
  // [
  //   {u: 1, v: 4, w: 9, x: 30, y: 31}, 
  //   {u: 0,       w: 7, x: 10, y: 11}, 
  //   {u: 3, v: 6, w: 8, x: 20       }, 
  //   {u: 2, v: 5                    }
  // ]
</code></pre>
<p>Notes:</p>
<ul>
<li>
<p>Any number of additional operands can be used with <code>crush</code> — since joins can be chained, each 'row' of results can have more than two objects.</p>
</li>
<li>
<p>If prefixes are not used and objects in the same row share a property name, the result will use the value from the last object in the row that has the property.</p>
</li>
<li>
<p>Use a falsy value to skip an optional operand, e.g. <code>someJoin crush null (# prefix '_')</code>.</p>
</li>
<li>
<p>Do not use the new prefixes when listing property names with <code>keep</code>.</p>
</li>
<li>
<p>If <code>keep</code> is not used, all enumerable own properties of the corresponding objects are included in the result.</p>
</li>
<li>
<p><code>crush</code> can be applied to any iterable-of-iterables. Elements of the inner iterables that are (non-null) objects are used to construct the result; other elements are ignored.</p>
</li>
</ul>
<hr>
<h4><code id="cross-join">crossJoin</code></h4>
<p>All pairs of elements from two iterables. <code>crossJoin</code> is equivalent to <code>innerJoin</code> with a callback function that always returns <code>true</code>:</p>
<ul>
<li>
<p><code>x crossJoin y</code> is equivalent to <code>x innerJoin y [true]</code></p>
</li>
<li>
<p><code>x crossJoin y 5</code> is equivalent to <code>x innerJoin y [true] 5</code></p>
</li>
</ul>
<pre><code>p = @ (@ 1 2) (@ 3 4)   // array-of-arrays
q = @ (@ 5 6) (@ 7 8)   // array-of-arrays

p crossJoin q array
  // [
  //   [[1, 2], [5, 6]], 
  //   [[1, 2], [7, 8]], 
  //   [[3, 4], [5, 6]], 
  //   [[3, 4], [7, 8]] 
  // ]

p crossJoin q crush (# prefix 'p_') (# prefix 'q_')
  // [
  //   {p_0: 1, p_1: 2, q_0: 5, q_1: 6}, 
  //   {p_0: 1, p_1: 2, q_0: 7, q_1: 8}, 
  //   {p_0: 3, p_1: 4, q_0: 5, q_1: 6}, 
  //   {p_0: 3, p_1: 4, q_0: 7, q_1: 8} 
  // ]
</code></pre>
<hr>
<h4><code>semiJoin</code>, <code id="semi-join">antiJoin</code></h4>
<p>These operators take the same operands as <a href="#inner-join"><code>innerJoin</code></a>.</p>
<p><code>semiJoin</code> yields elements of the first iterable that match an element of the second iterable. <code>antiJoin</code> yields elements of the first iterable that <em>do not</em> match any elements of the second iterable.</p>
<p>While <code>semiJoin</code> and <code>antiJoin</code> only yield elements from the first iterable, they behave like other join operators for consistency: they return a generator that yields arrays (each array containing a single object/array in this case):</p>
<pre><code>p = @ 
| (# u 1 v 4)
| (# u 2 v 5)
| (# u 3 v 6)        // array-of-objects

q = @
| (# u 0 w 7 x 10)
| (# u 3 w 8 x 20)
| (# u 1 w 9 x 30)   // array-of-objects

p semiJoin q 'u' array   // [[{u: 1, v: 4}], [{u: 3, v: 6}]]
p semiJoin q 'u' crush   // [{u: 1, v: 4}, {u: 3, v: 6}]
p antiJoin q 'u' crush   // [{u: 2, v: 5}]
</code></pre>
<h2 id="random">Random</h2>
<hr>
<p>These operators (except for <a href="#shuffle"><code>shuffle</code></a>) generate a number from a given distribution. An optional extra operand can be used to specify how many numbers to generate — in this case, the operator returns an array rather than a number.</p>
<hr>
<h4 id="random-op"><code>random</code></h4>
<p>Generate values from a uniform distribution with the given minimum (inclusive, default <code>0</code>) and maximum (exclusive, default <code>1</code>):</p>
<pre><code>random           // value in [0, 1)
random 5 10      // value in [5, 10)
random 5 10 20   // array of 20 values in [5, 10)
</code></pre>
<hr>
<h4 id="random-int"><code>randomInt</code></h4>
<p>Generate values from a discrete uniform distribution with the given minimum (inclusive, default <code>0</code>) and maximum (exclusive, default <code>2</code>):</p>
<pre><code>randomInt           // value in {0, 1}
randomInt 5 10      // value in {5, 6, 7, 8, 9}
randomInt 5 10 20   // array of 20 values in {5, 6, 7, 8, 9}
</code></pre>
<hr>
<h4 id="normal"><code>normal</code></h4>
<p>Generate values from a normal distribution with the given mean (default <code>0</code>) and standard deviation (default <code>1</code>):</p>
<pre><code>normal           // value from normal distbn: mean 0, sd 1
normal 5 10      // value from normal distbn: mean 5, sd 10
normal 5 10 20   // array of 20 values from normal distbn: mean 5, sd 10
</code></pre>
<hr>
<h4 id="log-normal"><code>logNormal</code></h4>
<p>Generate values from a log-normal distribution. Equivalent to applying <a href="#elementwise"><code>exp</code></a> to result of <a href="#normal"><code>normal</code></a>:</p>
<pre><code>logNormal   // is equivalent to:
normal exp

logNormal 5 3 20   // is equivalent to:
normal 5 3 20 exp
</code></pre>
<hr>
<h4 id="exponential"><code>exponential</code></h4>
<p>Generate values from an exponential distribution with the given rate:</p>
<pre><code>exponential 5      // value from exponential distbn: rate 5
exponential 5 20   // array of 20 values from exponential distbn: rate 5
</code></pre>
<hr>
<h4 id="binomial"><code>binomial</code></h4>
<p>Generate values from a binomial distribution with the given number of trials and success probability (default <code>0.5</code>):</p>
<pre><code>binomial 5       // value from binomial distbn: trials 5, prob 0.5
binomial 5 0.3   // value from binomial distbn: trials 5, prob 0.3

// array of 20 values from binomial distbn: trials 5, prob 0.3
binomial 5 0.3 20
</code></pre>
<hr>
<h4 id="geometric"><code>geometric</code></h4>
<p>Generate values (positive integers) from a geometric distribution with the given success probability (default <code>0.5</code>):</p>
<pre><code>geometric          // value from geometric distbn: prob 0.5
geometric 0.3      // value from geometric distbn: prob 0.3
geometric 0.3 20   // array of 20 values from geometric distbn: prob 0.3
</code></pre>
<hr>
<h4 id="categorical"><code>categorical</code></h4>
<p>Generate values from a categorical distribution with the given ratio — the 'probabilities' should be non-negative, but need not sum to 1. The ratio must be an iterable:</p>
<pre><code>// value in {0, 1}, probabilities: 3/4, 1/4
categorical (@ 3 1)      

// array of 20 values in {0, 1, 2}, probabilities: 1/6, 2/6, 3/6
1 to 3 categorical 20
</code></pre>
<hr>
<h4 id="shuffle"><code>shuffle</code></h4>
<p>Shuffle the elements of an iterable and return them in a new array:</p>
<pre><code>x = @ 5 7 9   // [5, 7, 9]
x shuffle     // possible result: [9, 5, 7]
x             // [5, 7, 9]

1 to 4 shuffle   // possible result: [2, 4, 1, 3]
</code></pre>
<h2 id="interpolate">Interpolate</h2>
<hr>
<p><code>interpolate</code> linearly interpolates between its first two operands. The third operand is the interpolation parameter:</p>
<pre><code>5 9 interpolate 0         // 5
5 9 interpolate 1         // 9
5 9 interpolate 0.5       // 7
5 9 interpolate (3 / 8)   // 6.5
5 9 interpolate 1.5       // 11
5 9 interpolate (-0.5)    // 3

20 10 interpolate 0.7     // 13

// interpolate multiple values
@ 0.2 0.6 0.9 map x (10 20 interpolate x)   // [12, 16, 19]
</code></pre>
<p><code>interpolate</code> treats all operands as numbers.</p>
<h2 id="nested-data">Nested Data</h2>
<br>
<blockquote>
<p>See <a href="#reduce">Reduce</a>, <a href="#filter">Filter</a>, <a href="#group">Group</a>, <a href="#order">Order</a> and <a href="#bin">Bin</a> for other operators that can act directly on nested data.</p>
</blockquote>
<hr>
<h4 id="pick"><code>pick</code></h4>
<p><code>pick</code> gets a property from each element of an iterable. The first operand of <code>pick</code> is the iterable; the second operand is the property name/index. <code>pick</code> returns an array:</p>
<pre><code>// pick from an array-of-arrays
@ 
| (@ 4 5 6)
| (@ 7 8 9)
| pick 1   // [5, 8]

// pick from a set-of-objects
@@
| (# u 4)
| (# u 5 v 6)
| (# u 7)
| pick 'v'   // [undefined, 6, undefined]

// pick from an array-of-strings
@ 'abc' 'def' pick 0   // ['a', 'd']
</code></pre>
<hr>
<h4 id="map-at"><code>mapAt</code></h4>
<p><code>mapAt</code> applies <a href="#at"><code>at</code></a> to each element of an iterable. The first operand is the iterable; the second and third operands are used as the second and third operands of <code>at</code>:</p>
<pre><code>// apply mapAt to an array-of-arrays
@
| (@ 4 5 6)
| (@ 7 8 9)
| mapAt (@ 2 0)
  // [
  //   [6, 4],
  //   [9, 7]
  // ]

// apply mapAt to an array-of-strings
@ 'abc' 'def' mapAt (@ 0 2)   // ['ac', 'df']

// set-of-objects
s = @@
| (# u 4 v 5)
| (# u 6 v 7 w 8)
| (# u 9 w 10)

s mapAt (@ 'u' 'w')
  // [
  //   {u: 4, w: undefined},
  //   {u: 6, w: 8},
  //   {u: 9, w: 10}
  // ]

s mapAt (@ 'u' 'w') 'array'
  // [
  //   [4, undefined],
  //   [6, 8],
  //   [9, 10]
  // ]
</code></pre>
<hr>
<h4 id="transpose"><code>transpose</code></h4>
<p><code>transpose</code> takes an iterable-of-iterables (typically an array-of-arrays) and returns an array-of-arrays:</p>
<pre><code>x = @ 
| (@ 5 6 7)
| (@ 10 20 30)   // [[5, 6, 7], [10, 20, 30]] 

x transpose      // [[5, 10], [6, 20], [7, 30]] 
</code></pre>
<p>The result of <code>transpose</code> can have empty elements and inner arrays of different lengths. Empty array elements in the original data have value <code>undefined</code> in the transpose:</p>
<pre><code>@ 
| (@ 1 2)
| (new Array 2)  // [empty, empty]
| (@ 3 4 5)
| (@ 6)
| transpose
  // [
  //   [1, undefined, 3, 6],
  //   [2, undefined, 4],
  //   [empty, empty, 5]
  // ] 
</code></pre>
<hr>
<h4 id="array-of-objects"><code>arrObj</code></h4>
<p><code>arrObj</code> takes an object-of-iterables (typically an object-of-arrays) and returns an array-of-objects:</p>
<pre><code>// object-of-arrays
data = #
| Name       (@ 'vw pickup' 'dodge rampage' 'ford ranger')
| Horsepower (@ 52 84 79)
| Origin     (@ 'Europe' 'USA' 'USA')

data arrObj
  // [
  //   {Name: 'vw pickup', Horsepower: 52, Origin: 'Europe'}
  //   {Name: 'dodge rampage', Horsepower: 84, Origin: 'USA'}
  //   {Name: 'ford ranger', Horsepower: 79, Origin: 'USA'}
  // ]
  
data arrObj (@ 'Horsepower' 'Origin')
  // [
  //   {Horsepower: 52, Origin: 'Europe'}
  //   {Horsepower: 84, Origin: 'USA'}
  //   {Horsepower: 79, Origin: 'USA'}
  // ]
</code></pre>
<p>As shown in the final example, <code>arrObj</code> can take a second operand (an iterable) that specifies the properties to include in the result. When this argument is omitted (or falsy), all properties are included.</p>
<p>The iterables in the original data can have different lengths:</p>
<pre><code>#
| u (@ 5 6 7)
| v (@ 8 9)
| arrObj   // [
           //   {u: 5, v: 8},
           //   {u: 6, v: 9},
           //   {u: 7}
           // ]
</code></pre>
<p>Empty array elements in the original data will result in properties with value <code>undefined</code> in the result.</p>
<hr>
<h4 id="object-of-arrays"><code>objArr</code></h4>
<p><code>objArr</code> takes an iterable-of-objects (typically an array-of-objects) and returns an object-of-arrays:</p>
<pre><code>// array-of-objects
data = @
| (# Name 'vw pickup'     Horsepower 52 Origin 'Europe')
| (# Name 'dodge rampage' Horsepower 84 Origin 'USA')
| (# Name 'ford ranger'   Horsepower 79 Origin 'USA')

data objArr
  // {
  //   Name: ['vw pickup', 'dodge rampage', 'ford ranger'],
  //   Horsepower: [52, 84, 79],
  //   Origin: ['Europe', 'USA', 'USA']
  // }

data objArr (@ 'Horsepower' 'Origin')
  // {
  //   Horsepower: [52, 84, 79],
  //   Origin: ['Europe', 'USA', 'USA']
  // }
</code></pre>
<p>As shown in the final example, <code>objArr</code> can take a second operand (an iterable) that specifies the properties to include in the result. When this argument is omitted (or falsy), the returned object has an array for each unique property name in the original data.</p>
<p>When a second operand is used, the arrays in the result have no empty elements and have the same length as the orginal data. When a second operand is not used, the arrays of the result can have empty elements and different lengths:</p>
<pre><code>data = @
| (# u 1 v 2)
| (# u 3 v 4 w 5)
| (# u 6)

data objArr (@ 'v' 'w')   // {
                          //   v: [2, 4, undefined],
                          //   w : [undefined, 5, undefined]
                          // }

data objArr   // {
              //   u: [1, 3, 6],
              //   v: [2, 4],
              //   w: [empty, 5]
              // }
</code></pre>
<h2 id="set-theory">Set Theory</h2>
<hr>
<p>Set theory operators take any number of iterables and return a new set. The order of elements is preserved, i.e. the order of elements in the result is determined by where the elements first appear in the operands.</p>
<hr>
<h4 id="difference"><code>difference</code></h4>
<p>Elements of the first operand that do not appear in any of the other operands:</p>
<pre><code>x = @ 3 7 2 9    // [3, 7, 2, 9]
s = @@ 9 7 5     // Set {9, 7, 5}
x difference s   // Set {3, 2}
</code></pre>
<hr>
<h4 id="intersection"><code>intersection</code></h4>
<p>Elements that appear in all operands:</p>
<pre><code>x = @ 3 7 2 9      // [3, 7, 2, 9]
s = @@ 9 7 5       // Set {9, 7, 5}
x intersection s   // Set {7, 9}
</code></pre>
<hr>
<h4 id="union"><code>union</code></h4>
<p>Elements that appear in any operand:</p>
<pre><code>x = @ 3 7 2 9   // [3, 7, 2, 9]
s = @@ 9 7 5    // Set {9, 7, 5}
x union s       // Set {3, 7, 2, 9, 5}
</code></pre>
<h2 id="import-and-export">Import and Export</h2>
<hr>
<p>The following rules apply to import and export operators:</p>
<ul>
<li>
<p>Can only be used at the 'top-level' — not inside parentheses, indented blocks or bracket functions.</p>
</li>
<li>
<p>The first operand of import operators is the module path/url which must be a string literal. All other operands of import and export operators must be <a href="#identifiers">identifiers</a>.</p>
</li>
<li>
<p>Return <code>undefined</code>.</p>
</li>
</ul>
<p>While not necessary, we typically use import and export operators at the start of a file:</p>
<pre><code>import '/modules/a.js' f1 f2
import '/modules/b.js' g
export h1 h2

h1 = [a \f1 \g]
h2 = [a \f2 \g]
</code></pre>
<blockquote>
<p>Do not assign to imports. Assignment operators that create <a href="#local-variables">local variables</a> will create a new variable that masks the import. Assignment operators that update variables (e.g. <a href="#update-assignment"><code>+=</code></a>) will throw an error since imports are constants.</p>
</blockquote>
<hr>
<h4 id="export"><code>export</code></h4>
<p>Export variables:</p>
<pre><code>export add subtract

add = [a + b]
subtract = [a - b]
</code></pre>
<p><code>export</code> can only be used once per file.</p>
<hr>
<h4 id="import"><code>import</code></h4>
<p>Use <code>import</code> with one operand to import a module for side effects only:</p>
<pre><code>import '/modules/do-something.js'
</code></pre>
<p>Use additional operands for named imports:</p>
<pre><code>import '/modules/arithmetic.js' add subtract
// use add and subtract here
</code></pre>
<hr>
<h4 id="import-as"><code>importAs</code></h4>
<p>Rename imports. Operands are passed as <em>importName</em> <em>newName</em> pairs:</p>
<pre><code>importAs '/modules/arithmetic.js'
| add plus
| subtract takeaway
// use plus and takeaway here
</code></pre>
<hr>
<h4 id="import-all"><code>importAll</code></h4>
<p>Import all of a module's exports as an object:</p>
<pre><code>importAll '/modules/arithmetic.js' arith
// use arith,add and arith,subtract here
</code></pre>
<hr>
<h4 id="import-default"><code>importDefault</code></h4>
<p>Import default export.</p>
<p>Zap does not use default exports, but many JavaScript modules do:</p>
<pre><code>importDefault '/modules/my-js-module.js' theDefault
// use theDefault here
</code></pre>
<hr>
<h4 id="load"><code>load</code></h4>
<p>Dynamically import a module.</p>
<p><code>load</code> is not subject to the restrictions that apply to other import operators: <code>load</code> can be used anywhere and the module path/url can be any expression. <code>import</code> returns a promise that resolves to an object:</p>
<pre><code>load '/modules/arithmetic.js' ~then 
    fun arith
        // use arith,add and arith,subtract here
</code></pre>
<p>Or using <code>await</code>:</p>
<pre><code>asyncScope
    add subtract #= '/modules/arithmetic.js' load await
    // use add and subtract here
</code></pre>
<hr>
<h4>CommonJS Modules</h4>
<p>CommonJS modules do not require dedicated operators or rules.</p>
<p>The following export examples are equivalent:</p>
<pre><code>module,exports = #
| add [a + b]
| subtract [a - b]
</code></pre>
<pre><code>add = [a + b]
subtract = [a - b]
exports attach add subtract
</code></pre>
<pre><code>exports
| chg 'add' [a + b]
| chg 'subtract' [a - b]
</code></pre>
<p>Use the <code>require</code> function to load a module:</p>
<pre><code>arith = 'arithmetic.js' \require
// use arith,add and arith,subtract here
</code></pre>
<p>Or with destructuring:</p>
<pre><code>add subtract #= 'arithmetic.js' \require
// use add and subtract here
</code></pre>
<h2 id="print-and-debug">Print and Debug</h2>
<hr>
<h4 id="print"><code>print</code></h4>
<p>Print operand and return it:</p>
<pre><code>print 5            // prints and returns 5
# u 5 v 6 print    // prints and returns {u: 5, v: 6}
x = 5 print + 10   // prints 5, returns 15
x                  // 15
</code></pre>
<blockquote>
<p><code>print</code> uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/Console/log"><code>console,log</code></a>.</p>
</blockquote>
<hr>
<h4 id="debugger"><code>debugger</code></h4>
<p>Invoke debugger (if it exists):</p>
<pre><code>debugger
</code></pre>
<hr>
<h4 id="period"><code>period</code></h4>
<p>Create a promise that resolves after the given number of milliseconds:</p>
<pre><code>500 period   // promise that resolves (to undefined) after 500 ms
</code></pre>
<p>If used with two operands, <code>period</code> resolves to the value of the second operand:</p>
<pre><code>// waits 1000 ms, prints 'abc'
asyncScope
    1000 period 'abc' await print
</code></pre>
<blockquote>
<p><code>period</code> uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout"><code>setTimeout</code></a>.</p>
</blockquote>
<h2 id="dom">DOM</h2>
<hr>
<p>The following terms are used in this section to describe the elements associated with an operand:</p>
<p id="first-element"><b><i>first element</i></b>:</p>
<ul>
<li>
<p>CSS selector string → first matching element.</p>
</li>
<li>
<p>non-string iterable → first element.</p>
</li>
<li>
<p>element → element.</p>
</li>
</ul>
<p id="all-elements"><b><i>all elements</i></b>:</p>
<ul>
<li>
<p>CSS selector string → all matching elements; where relevant, the operator returns the elements as an array.</p>
</li>
<li>
<p>non-string iterable → all elements of the iterable; where relevant, the operator returns the iterable.</p>
</li>
<li>
<p>element → element; where relevant, the operator returns the element.</p>
</li>
</ul>
<blockquote>
<p>The DOM operators are loosely based on <a href="https://github.com/d3/d3-selection">d3-selection</a>. In particular, data can be encoded as (and is automatically attached to) elements. Zap uses the <a href="#encode"><code>encode</code></a> operator to map data to elements rather than D3's <em>enter-update-exit</em> approach. Currently, <code>encode</code> cannot map data to existing elements; this functionality will be added in a future version.</p>
</blockquote>
<hr>
<h4 id="select"><code>select</code></h4>
<p><code>select</code> takes a CSS selector string and returns the first matching element — or <code>null</code> if there are no matching elements.
When used with one operand, <code>select</code> searches the document. If two operands are used, <code>select</code> searches the descendants of the <a href="#first-element">first element</a> of the first operand:</p>
<pre><code>select 'p'               // first &lt;p&gt; in the document
select '.news p'         // first &lt;p&gt; in an element with class 'news' 
elmA select 'p'          // first &lt;p&gt; in element elmA
@ elmA elmB select 'p'   // first &lt;p&gt; in element elmA 
'.news' select 'p'       // first &lt;p&gt; in first element with class 'news'
</code></pre>
<p>Since many DOM operators can take a CSS selector string, <code>select</code> and <a href="#select-all"><code>selectAll</code></a> are not used as frequently as might be expected.</p>
<hr>
<h4 id="select-all"><code>selectAll</code></h4>
<p>As <a href="#select"><code>select</code></a>, but <code>selectAll</code> returns all of the matching elements as an array — an empty array if there are no matching elements.</p>
<hr>
<h4 id="create"><code>create</code>, <code>createSVG</code></h4>
<p>Create HTML/SVG elements. The first operand is a tag name:</p>
<pre><code>create 'p'         // &lt;p&gt;
createSVG 'rect'   // &lt;rect&gt;
</code></pre>
<p>The second operand specifies the number of elements to create. When a second operand is used, an array is returned:</p>
<pre><code>create 'p' 2         // [&lt;p&gt;, &lt;p&gt;]
createSVG 'rect' 2   // [&lt;rect&gt;, &lt;rect&gt;]
</code></pre>
<p>Typically, we use <a href="#create-convenience">convenience operators</a> instead of <code>create</code>/<code>createSVG</code>. For example:</p>
<pre><code>$p        // &lt;p&gt;
$rect 2   // [&lt;rect&gt;, &lt;rect&gt;]
</code></pre>
<hr>
<h4 id="fragment"><code>fragment</code></h4>
<p><code>fragment</code> takes no operands and returns a new document fragment.</p>
<hr>
<h4 id="encode"><code>encode</code>, <code>encodeSVG</code></h4>
<p><code>encode</code> takes an iterable (the 'data') and an HTML tag name. For each datum, an HTML element of the given tag name is created and the element's <code>__data__</code> property is set to the datum. The new elements are returned as an array:</p>
<pre><code>p = @ 5 6 7 encode 'p'   // [&lt;p&gt;, &lt;p&gt;, &lt;p&gt;]
p,1,__data__             // 6
</code></pre>
<p>Various DOM operators such as <a href="#insert"><code>insert</code></a>, <a href="#into"><code>into</code></a>, <a href="#insert-each"><code>insertEach</code></a>, <a href="#attr"><code>attr</code></a>, <a href="#attr"><code>prop</code></a>, <a href="#attr"><code>style</code></a>, <a href="#html"><code>html</code></a>, <a href="#html"><code>text</code></a>, <a href="#on"><code>on</code></a> and <a href="#on"><code>off</code></a> use the <code>__data__</code> property of elements — it is rare to use the <code>__data__</code> property explicitly.</p>
<p>The optional third operand of <code>encode</code> specifies whether to set the <code>__data__</code> property of the new elements. This operand defaults to <code>true</code>.</p>
<p>Use <code>encodeSVG</code> to encode data as SVG elements rather than HTML:</p>
<pre><code>o = @ (# u 5 v 6) (# u 7 v 8)
r = encodeSVG o 'rect'   // [&lt;rect&gt;, &lt;rect&gt;]
r,1,__data__             // {u: 7, v: 8}
</code></pre>
<hr>
<h4 id="insert"><code>insert</code></h4>
<p>Insert <a href="#all-elements">all elements</a> of the second operand into the 'target': the <a href="#first-element">first element</a> of the first operand. Alternatively, the second operand can be a callback function that returns an element or an iterable of elements. The callback is passed the target's data (see <a href="#encode"><code>encode</code></a>) and the callback's <code>this</code> is set to the target.</p>
<p><code>insert</code> returns the inserted element(s):</p>
<pre><code>// insert 3 &lt;p&gt; into elm, returns [&lt;p&gt;, &lt;p&gt;, &lt;p&gt;]
elm insert (3 $p)

// insert 1 &lt;p&gt; into elm, returns [&lt;p&gt;]
elm insert (1 $p)

// insert 1 &lt;p&gt; into elm, returns &lt;p&gt;
elm insert ($p)

// insert all &lt;p&gt; in document into elm, returns all &lt;p&gt; as an array
elm insert 'p'
</code></pre>
<p>As shown in the final example, <code>insert</code> can be used to move elements that are already in the document.</p>
<p>The optional third operand of <code>insert</code> specifies where to insert elements into the target. The third operand must be a callback function; it is passed the target's data and the callback's <code>this</code> is set to the target. Elements are inserted before the <a href="#first-element">first element</a> returned by the callback. If the callback returns <code>null</code> or is omitted, elements are inserted at the end of the target.</p>
<hr>
<h4 id="into"><code>into</code></h4>
<p><code>into</code> is the same as <a href="#insert"><code>insert</code></a>, but with the first two operands swapped. The only other difference is that <code>into</code> returns the target element rather than the inserted elements:</p>
<pre><code>2 $p into ($div)   // &lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;
</code></pre>
<hr>
<h4 id="insert-each"><code>insertEach</code></h4>
<p><code>insertEach</code> is similar to using <a href="#insert"><code>insert</code></a> on each element of the first operand (which can be a CSS selector string, an iterable of elements or an element). However, the second operand of <code>insertEach</code> <em>must</em> be a callback function. The callback is passed the 'current index' as its second argument and the results of the callback are collected in an array and returned (each entry of the array is an element or an iterable of elements):</p>
<pre><code>divs = @ 5 6 7 encode 'div'   // [&lt;div&gt;, &lt;div&gt;, &lt;div&gt;]

// insert a &lt;p&gt; into each &lt;div&gt;
ps = divs insertEach
    fun data index
        $p text 
            + this,tagName' 'data' 'index
            
ps        // [&lt;p&gt;, &lt;p&gt;, &lt;p&gt;]
ps text   // ['DIV 5 0', 'DIV 6 1' 'DIV 7 2']
</code></pre>
<p>The following example uses <code>insert</code> and <code>insertEach</code> to represent an array-of-arrays as an HTML table:</p>
<pre><code>x = @ (@ 4 5 6) (@ 7 8 9)   // [[4, 5, 6], [7, 8, 9]]

'body' insert ($table)
| insert [encode x 'tr']
| insertEach [a encode 'td' text [a]]
</code></pre>
<hr>
<h4 id="attr"><code>attr</code>, <code>prop</code>, <code>style</code></h4>
<p>Get or set an attribute/property/style of <a href="#all-elements">all elements</a> of the first operand.</p>
<p>The second operand is the attribute/property/style name.</p>
<p>When used with two operands, these operators are getters. If the first operand is an iterable, the values are returned as an array.</p>
<p>When used with three operands, these operators are setters. If the third operand is a function, it is called for each element. The function is passed the element's <code>__data__</code> property (see <a href="#encode"><code>encode</code></a>) and the current index; the function's <code>this</code> is set to the element. The value returned by the function is used as the new attribute/property/style value. If the third operand is not a function, it is used as the new attribute/property/style value for each element. Setters return the modified element(s).</p>
<pre><code>divs = @ 'red' 'blue' encode 'div'
| style 'background-color' [a]
| style 'height' '20px'   // [&lt;div&gt;, &lt;div&gt;]

// style gets computed style - elements must be in the document
divs into 'body'

divs style 'background-color'   // [&quot;rgb(255, 0, 0)&quot;, &quot;rgb(0, 0, 255)&quot;]
divs style 'height'             // ['20px', '20px']
divs,0 style 'height'           // '20px'

'div' style 'width' '40px'   // set width of all divs in document
'div' style 'width'          // ['40px', '40px'] (if no preexisting divs)
</code></pre>
<p>A callback function can be used with any elements; they need not have their own data:</p>
<pre><code>colors = @ 'red' 'green' 'blue'

// create 3 &lt;p&gt;, give each a different color
3 $p style 'color' [colors;b]
</code></pre>
<p><code>style</code> can be used to get/set <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties">CSS variables</a>:</p>
<pre><code>// use 'html' or document,documentElement to set globals
// (i.e. variables that would be set under :root in CSS)
'html' style '--size' '24px'

// scope --color variable to element with id 'apple'
'#apple' style '--color' 'green'
</code></pre>
<hr>
<h4 id="html"><code>html</code>, <code>text</code></h4>
<p><code>html</code> and <code>text</code> are shorthand getters/setters for the <code>innerHTML</code> and <code>textContent</code> properties respectively. Specifically, they are equivalent to using <a href="#attr"><code>prop</code></a>:</p>
<ul>
<li>
<p><code>e html</code> is equivalent to <code>e prop 'innerHTML'</code></p>
</li>
<li>
<p><code>e html h</code> is equivalent to <code>e prop 'innerHTML' h</code></p>
</li>
<li>
<p><code>e text</code> is equivalent to <code>e prop 'textContent'</code></p>
</li>
<li>
<p><code>e text t</code> is equivalent to <code>e prop 'textContent' t</code></p>
</li>
</ul>
<hr>
<h4 id="remove"><code>remove</code></h4>
<p>Remove <a href="#all-elements">all elements</a> of the operand from the document.</p>
<p>Returns the element(s).</p>
<hr>
<h4 id="lower"><code>lower</code>, <code>raise</code></h4>
<p>Move <a href="#all-elements">all elements</a> of the operand (in order) to be the first child (<code>lower</code>) or the last child (<code>raise</code>) of their parents.</p>
<p>Returns the element(s).</p>
<hr>
<h4 id="add-class"><code>addClass</code>, <code>removeClass</code></h4>
<p>Add/remove classes from <a href="#all-elements">all elements</a> of the first operand. The second operand is a string of space-separated class names.</p>
<p>Returns the element(s).</p>
<hr>
<h4 id="toggle-class"><code>toggleClass</code></h4>
<p>Add or remove a class from <a href="#all-elements">all elements</a> of the first operand: if an element has the class, it is removed; otherwise it is added. The second operand is the class name.</p>
<p>Returns the element(s).</p>
<hr>
<h4 id="remove-attr"><code>removeAttr</code>, <code>removeStyle</code></h4>
<p>Remove an attribute/style from <a href="#all-elements">all elements</a> of the first operand. The second operand is the name of the attribute/style to remove.</p>
<p>Returns the element(s).</p>
<hr>
<h4 id="has-attr"><code>hasAttr</code>, <code>hasClass</code></h4>
<p>For <a href="#all-elements">all elements</a> of the first operand, indicate if each element has the attribute/class specified by the second operand.</p>
<p>If the first operand is an iterable, these operators return an array of booleans. Otherwise, they return a boolean.</p>
<hr>
<h4 id="on"><code>on</code>, <code>off</code></h4>
<p>Add/remove event listeners from <a href="#all-elements">all elements</a> of the first operand. The second operand is a string of space-separated event types. The third operand is the event handler — a function. The handler is passed the element's <code>__data__</code> property (see <a href="#encode"><code>encode</code></a>) and the event. The handler's <code>this</code> is set to the element:</p>
<pre><code>@ 5 6 7 encode 'p'
| text 'show data'
| on 'click' [this text a]    // [&lt;p&gt;, &lt;p&gt;, &lt;p&gt;] 
</code></pre>
<p>The optional fourth operand is an options object or a boolean indicating whether to use capture — see <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">EventTarget,addEventListener</a> for details. The fourth operand defaults to <code>false</code>.</p>
<p>The behavior of <code>on</code> and <code>off</code> differs slightly from that of the native methods <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">EventTarget,addEventListener</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener">EventTarget,removeEventListener</a>:</p>
<ul>
<li>
<p>The event handler <em>must</em> be a function when using <code>on</code> and <code>off</code>.</p>
</li>
<li>
<p>The event is the <em>second</em> argument passed to the event handler when using <code>on</code> and <code>off</code> — the event is the only argument when using the native methods.</p>
</li>
<li>
<p><code>on</code> skips elements where the event handler is already registered for the given event type — even if the fourth operand of <code>on</code> is different to when the handler was originally registered.</p>
</li>
</ul>
<p><code>on</code> and <code>off</code> return the element(s).</p>
<hr>
<h4 id="sketch"><code>sketch</code></h4>
<p><code>sketch</code> creates a <code>&lt;canvas&gt;</code> element and a drawing context. <code>sketch</code> can be used with no operands or with an options object. The options are:</p>
<ul>
<li>
<p><code>width</code>: canvas width in pixels (default: <code>300</code>).</p>
</li>
<li>
<p><code>height</code>: canvas height in pixels (default: <code>300</code>).</p>
</li>
<li>
<p><code>context</code>: context type (default: <code>'2d'</code>).</p>
</li>
<li>
<p><code>scale</code>: scale canvas and context to account for the device pixel ratio (default: <code>true</code>).</p>
</li>
</ul>
<p>The <code>scale</code> option is ignored if <code>context</code> is not <code>'2d'</code>.</p>
<p>Any additional options passed to <code>sketch</code> are passed on to <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext"><code>getContext</code></a> when creating the context.</p>
<p>The canvas and context are returned as an array:</p>
<pre><code>canvas ctx @= sketch

ctx,fillStyle = 'green'
ctx ~fillRect 50 20 200 100
</code></pre>
<hr>
<h4 id="create-convenience">Convenience Operators for Creating Elements</h4>
<p>The following are convenience operators for creating elements:</p>
<p><strong>HTML:</strong></p>
<p><code>$a</code> <code>$abbr</code> <code>$address</code> <code>$area</code> <code>$article</code> <code>$aside</code> <code>$audio</code> <code>$b</code> <code>$base</code> <code>$bdi</code> <code>$bdo</code> <code>$blockquote</code> <code>$body</code> <code>$br</code> <code>$button</code> <code>$canvas</code> <code>$caption</code> <code>$cite</code> <code>$code</code> <code>$col</code> <code>$colgroup</code> <code>$data</code> <code>$datalist</code> <code>$dd</code> <code>$del</code> <code>$details</code> <code>$dfn</code> <code>$dialog</code> <code>$div</code> <code>$dl</code> <code>$dt</code> <code>$em</code> <code>$embed</code> <code>$fieldset</code> <code>$figcaption</code> <code>$figure</code> <code>$footer</code> <code>$form</code> <code>$h1</code> <code>$h2</code> <code>$h3</code> <code>$h4</code> <code>$h5</code> <code>$h6</code> <code>$head</code> <code>$header</code> <code>$hgroup</code> <code>$hr</code> <code>$i</code> <code>$iframe</code> <code>$img</code> <code>$input</code> <code>$ins</code> <code>$kbd</code> <code>$label</code> <code>$legend</code> <code>$li</code> <code>$link</code> <code>$main</code> <code>$map</code> <code>$mark</code> <code>$menu</code> <code>$meta</code> <code>$meter</code> <code>$nav</code> <code>$noscript</code> <code>$object</code> <code>$ol</code> <code>$optgroup</code> <code>$option</code> <code>$output</code> <code>$p</code> <code>$param</code> <code>$picture</code> <code>$pre</code> <code>$progress</code> <code>$q</code> <code>$rb</code> <code>$rp</code> <code>$rt</code> <code>$rtc</code> <code>$ruby</code> <code>$s</code> <code>$samp</code> <code>$script</code> <code>$section</code> <code>$select</code> <code>$slot</code> <code>$small</code> <code>$source</code> <code>$span</code> <code>$strong</code> <code>$style</code> <code>$sub</code> <code>$summary</code> <code>$sup</code> <code>$table</code> <code>$tbody</code> <code>$td</code> <code>$template</code> <code>$textarea</code> <code>$tfoot</code> <code>$th</code> <code>$thead</code> <code>$time</code> <code>$title</code> <code>$tr</code> <code>$track</code> <code>$u</code> <code>$ul</code> <code>$var</code> <code>$video</code> <code>$wbr</code></p>
<p><strong>SVG:</strong></p>
<p><code>$animate</code> <code>$animateMotion</code> <code>$animateTransform</code> <code>$circle</code> <code>$clipPath</code> <code>$defs</code> <code>$desc</code> <code>$discard</code> <code>$ellipse</code> <code>$feBlend</code> <code>$feColorMatrix</code> <code>$feComponentTransfer</code> <code>$feComposite</code> <code>$feConvolveMatrix</code> <code>$feDiffuseLighting</code> <code>$feDisplacementMap</code> <code>$feDistantLight</code> <code>$feDropShadow</code> <code>$feFlood</code> <code>$feFuncA</code> <code>$feFuncB</code> <code>$feFuncG</code> <code>$feFuncR</code> <code>$feGaussianBlur</code> <code>$feImage</code> <code>$feMerge</code> <code>$feMergeNode</code> <code>$feMorphology</code> <code>$feOffset</code> <code>$fePointLight</code> <code>$feSpecularLighting</code> <code>$feSpotLight</code> <code>$feTile</code> <code>$feTurbulence</code> <code>$filter</code> <code>$foreignObject</code> <code>$g</code> <code>$hatch</code> <code>$hatchpath</code> <code>$image</code> <code>$line</code> <code>$linearGradient</code> <code>$marker</code> <code>$mask</code> <code>$metadata</code> <code>$mpath</code> <code>$path</code> <code>$pattern</code> <code>$polygon</code> <code>$polyline</code> <code>$radialGradient</code> <code>$rect</code> <code>$set</code> <code>$solidcolor</code> <code>$stop</code> <code>$svg</code> <code>$switch</code> <code>$symbol</code> <code>$text</code> <code>$textPath</code> <code>$tspan</code> <code>$use</code> <code>$view</code></p>
<p>Using these operators is equivalent to using <a href="#create"><code>create</code></a>/<a href="#create"><code>createSVG</code></a>. For example:</p>
<ul>
<li>
<p><code>$div</code> is equivalent to <code>create 'div'</code></p>
</li>
<li>
<p><code>$div 5</code> is equivalent to <code>create 'div' 5</code></p>
</li>
<li>
<p><code>$circle</code> is equivalent to <code>createSVG 'circle'</code></p>
</li>
<li>
<p><code>$circle 5</code> is equivalent to <code>createSVG 'circle' 5</code></p>
</li>
</ul>
<blockquote>
<p>Where HTML and SVG elements have the same name (e.g. <code>a</code>, <code>script</code>, <code>style</code> and <code>title</code>), there are convenience operators for the HTML elements, but not for the SVG elements.</p>
</blockquote>

      <br><br><br><br><br><br>
    </div>
  </div>
  <script type="module" src="index.min.js"></script>
</body>

</html>