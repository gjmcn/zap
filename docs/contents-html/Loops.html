<h2>Loops</h2>
<hr>
<blockquote>
<p>Operators for working with iterables (including loop operators, but also see e.g. <a href="?Reduce">Reduce</a>, <a href="?Filter-and-Group">Filter and Group</a>, <a href="?Order-and-Bin">Order and Bin</a>, <a href="?Backticks">Backticks</a> and <a href="?Tabular-Data">Tabular Data</a>) treat empty array elements as normal elements (with value <code>undefined</code>). In contrast, some array methods ignore empty elements.</p>
</blockquote>
<hr>
<h4 id="each"><code>each</code></h4>
<p>Loop over an iterable.</p>
<p>The first operand of <code>each</code> is the iterable; the final operand is the loop <a href="?Syntax#body-rules">body</a>. Between these, we can provide optional <em>loop parameters</em> for the current value, current index and the iterable:</p>
<pre><code>// body in parentheses, prints: 4 5 6
@ 4 5 6 each x (print x)

// body in indented block, prints: 'a0' 'b1' 'c2'
'abc' each s i
    s + i print
</code></pre>
<p><code>each</code> returns the iterable.</p>
<p>Use <code>stop</code> to exit a loop <em>at the end of the current step</em>:</p>
<pre><code>// prints 4 5 6
@ 4 5 6 7 8 each x
    print x
    if (x == 6)
        stop

// prints 4 5 6
@ 4 5 6 7 8 each x
    if (x == 6)
        stop
    print x
</code></pre>
<hr>
<h4 id="map"><code>map</code></h4>
<p>As <a href="#each"><code>each</code></a>, but <code>map</code> collects the value of the body (the last expression evaluated) at each step in an array:</p>
<pre><code>@ 4 5 6 map x (x + 10)   // [14, 15, 16]

// returns [14, 15, 16]
@ 4 5 6 7 8 map x i
    if (i == 2)
        stop
    x + 10
</code></pre>
<hr>
<h4 id="do"><code>do</code></h4>
<p>Basic loop.</p>
<p>The final operand of <code>do</code> is the loop <a href="?Syntax#body-rules">body</a>. The optional operands are the maximum number of steps and the current index:</p>
<pre><code>// prints 0 1 2 3 4
5 do i
    print i
</code></pre>
<p><code>do</code> returns <code>undefined</code>.</p>
<p>Use <code>stop</code> to exit a loop <em>at the end of the current step</em>.</p>
<p>Use <code>Infinity</code> as the maximum number of steps when there is no actual maximum, but the index parameter is required:</p>
<pre><code>// prints 0 1 2 3 4
Infinity do i
    print i
    if (i == 4)
        stop
</code></pre>
<p>If only the loop body is given, the maximum number of steps defaults to <code>Infinity</code>:</p>
<pre><code>x = 1
do
    x *= 2
    if (x &gt; 20)
        stop
x   // 32
</code></pre>
<p>Even though <code>stop</code> only exits a loop at the end of the current step, we can use <code>if</code> with an <code>else</code> branch to effectively exit a loop at the point where <code>stop</code> is encountered:</p>
<pre><code>x = 25
do
    if (x &gt; 20)
        stop
    | else
        x *= 2
x   // 25
</code></pre>
<p>The maximum number of steps is fixed before the loop starts:</p>
<pre><code>// prints 0 1 2 3 4
n = 5
n do i
    n += 10
    print i
</code></pre>
<hr>
<h4 id="async-loops"><code>asyncEach</code>, <code>asyncMap</code>, <code>asyncDo</code></h4>
<p>Asynchronous versions of <a href="#each"><code>each</code></a>, <a href="#map"><code>map</code></a> and <a href="#do"><code>do</code></a>.</p>
<p>These operators return a promise that resolves to:</p>
<ul>
<li><code>asyncEach</code>: the iterable</li>
<li><code>asyncMap</code>: a new array</li>
<li><code>asyncDo</code>: <code>undefined</code></li>
</ul>
<p><code>await</code> can be used in the body of an asynchronous loop. The following example uses <a href="?Print-and-Debug#period"><code>period</code></a> to create a promise that resolves after 1000 milliseconds:</p>
<pre><code>// wait 1000 ms, print 5, wait 1000 ms, print 6 
@ 5 6 asyncEach x
    period 1000 await
    print x
</code></pre>
<p>If the parent <a href="?Scope">scope</a> of an asynchronous loop is asynchronous, we can <code>await</code> the loop itself. The following example uses <a href="?Scope#scope-op"><code>asyncScope</code></a> to create an asynchronous scope:</p>
<pre><code>// wait 1000 ms, print 5, wait 1000 ms, print 6, print 'done'
asyncScope
    @ 5 6 asyncEach x
        period 1000 await
        print x
    | await
    print 'done'
</code></pre>
<hr>
<h4 id="loop-variables">Loop Parameters and Variables</h4>
<p>Loop parameters, and variables created inside the loop body are local to a single step of the loop. Assigning a new value to a parameter/variable will not affect its value at the next step, nor will it affect the behavior of the loop.</p>
<hr>
<h4 id="yield-in-loops">Using <code>yield</code> and <code>yieldFrom</code></h4>
<p>If <code>yield</code> or <code>yieldFrom</code> is used in the body of an <a href="#each"><code>each</code></a>, <a href="#do"><code>do</code></a>, <a href="#async-loops"><code>asyncEach</code></a> or <a href="#async-loops"><code>asyncDo</code></a> loop, the operator returns a generator (or asynchronous generator):</p>
<pre><code>g = @ 5 6 7 each x (yield x)   // generator
g array                        // [5, 6, 7]

@ 5 6 7 each x
    yield x
    yieldFrom 'ab'   // generator
| array              // [5, 'a', 'b', 6, 'a', 'b', 7, 'a', 'b']
</code></pre>


<br><br><br>